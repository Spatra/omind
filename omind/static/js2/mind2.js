mindmaps.action={};mindmaps.action.Action=function(){};mindmaps.action.Action.prototype={noUndo:function(){delete this.undo;delete this.redo;return this},noEvent:function(){delete this.event;return this},execute:function(){},cancel:function(){this.cancelled=!0}};mindmaps.action.MoveNodeAction=function(a,b){var c=a.offset;this.execute=function(){a.offset=b};this.event=[mindmaps.Event.NODE_MOVED,a];this.undo=function(){return new mindmaps.action.MoveNodeAction(a,c)}};
mindmaps.action.MoveNodeAction.prototype=new mindmaps.action.Action;mindmaps.action.DeleteNodeAction=function(a,b){var c=a.getParent();this.execute=function(){if(a.isRoot())return!1;b.removeNode(a)};this.event=[mindmaps.Event.NODE_DELETED,a,c];this.undo=function(){return new mindmaps.action.CreateNodeAction(a,c,b)}};mindmaps.action.DeleteNodeAction.prototype=new mindmaps.action.Action;
mindmaps.action.CreateAutoPositionedNodeAction=function(a,b){if(a.isRoot())var c=mindmaps.Util.randomColor(),d=0.49<Math.random()?1:-1,e=0.49<Math.random()?1:-1,d=d*(100+250*Math.random()),e=e*250*Math.random();else{c=a.branchColor;d=0<a.offset.x?1:-1;d*=150+10*Math.random();if(a.isLeaf())var e=5,f=-5;else e=150,f=-150;e=Math.floor(Math.random()*(e-f+1)+f)}f=new mindmaps.Node;f.branchColor=c;f.shouldEditCaption=!0;f.offset=new mindmaps.Point(d,e);return new mindmaps.action.CreateNodeAction(f,a,b)};
mindmaps.action.CreateNodeAction=function(a,b,c){this.execute=function(){c.addNode(a);b.addChild(a)};this.event=[mindmaps.Event.NODE_CREATED,a];this.undo=function(){return new mindmaps.action.DeleteNodeAction(a,c)}};mindmaps.action.CreateNodeAction.prototype=new mindmaps.action.Action;mindmaps.action.CreateNodeNoRenderAction=function(a,b,c){this.execute=function(){c.addNode(a);b.addChild(a)};this.event=[mindmaps.Event.NODE_CREATED_NO_RENDER,a]};mindmaps.action.CreateNodeNoRenderAction.prototype=new mindmaps.action.Action;
mindmaps.action.NodeRenderingAction=function(a){this.execute=function(){};this.event=[mindmaps.Event.NODE_RENDERING,a]};mindmaps.action.CreateNodeNoRenderAction.prototype=new mindmaps.action.Action;mindmaps.action.ToggleNodeFoldAction=function(a){return a.foldChildren?new mindmaps.action.OpenNodeAction(a):new mindmaps.action.CloseNodeAction(a)};mindmaps.action.OpenNodeAction=function(a){this.execute=function(){a.foldChildren=!1};this.event=[mindmaps.Event.NODE_OPENED,a]};
mindmaps.action.OpenNodeAction.prototype=new mindmaps.action.Action;mindmaps.action.CloseNodeAction=function(a){this.execute=function(){a.foldChildren=!0};this.event=[mindmaps.Event.NODE_CLOSED,a]};mindmaps.action.CloseNodeAction.prototype=new mindmaps.action.Action;
mindmaps.action.ChangeNodeCaptionAction=function(a,b){var c=a.getCaption();this.execute=function(){if(c===b)return!1;a.setCaption(b)};this.event=[mindmaps.Event.NODE_TEXT_CAPTION_CHANGED,a];this.undo=function(){return new mindmaps.action.ChangeNodeCaptionAction(a,c)}};mindmaps.action.ChangeNodeCaptionAction.prototype=new mindmaps.action.Action;
mindmaps.action.ChangeNodeFontSizeAction=function(a,b){this.execute=function(){a.text.font.size+=b};this.event=[mindmaps.Event.NODE_FONT_CHANGED,a];this.undo=function(){return new mindmaps.action.ChangeNodeFontSizeAction(a,-b)}};mindmaps.action.ChangeNodeFontSizeAction.prototype=new mindmaps.action.Action;mindmaps.action.DecreaseNodeFontSizeAction=function(a){return new mindmaps.action.ChangeNodeFontSizeAction(a,-4)};
mindmaps.action.IncreaseNodeFontSizeAction=function(a){return new mindmaps.action.ChangeNodeFontSizeAction(a,4)};mindmaps.action.SetFontWeightAction=function(a,b){this.execute=function(){a.text.font.weight=b?"bold":"normal"};this.event=[mindmaps.Event.NODE_FONT_CHANGED,a];this.undo=function(){return new mindmaps.action.SetFontWeightAction(a,!b)}};mindmaps.action.SetFontWeightAction.prototype=new mindmaps.action.Action;
mindmaps.action.SetFontStyleAction=function(a,b){this.execute=function(){a.text.font.style=b?"italic":"normal"};this.event=[mindmaps.Event.NODE_FONT_CHANGED,a];this.undo=function(){return new mindmaps.action.SetFontStyleAction(a,!b)}};mindmaps.action.SetFontStyleAction.prototype=new mindmaps.action.Action;
mindmaps.action.SetFontDecorationAction=function(a,b){var c=a.text.font.decoration;this.execute=function(){a.text.font.decoration=b};this.event=[mindmaps.Event.NODE_FONT_CHANGED,a];this.undo=function(){return new mindmaps.action.SetFontDecorationAction(a,c)}};mindmaps.action.SetFontDecorationAction.prototype=new mindmaps.action.Action;
mindmaps.action.SetFontColorAction=function(a,b){var c=a.text.font.color;this.execute=function(){a.text.font.color=b};this.event=[mindmaps.Event.NODE_FONT_CHANGED,a];this.undo=function(){return new mindmaps.action.SetFontColorAction(a,c)}};mindmaps.action.SetFontColorAction.prototype=new mindmaps.action.Action;
mindmaps.action.SetBranchColorAction=function(a,b){var c=a.branchColor;this.execute=function(){if(b===a.branchColor)return!1;a.branchColor=b};this.event=[mindmaps.Event.NODE_BRANCH_COLOR_CHANGED,a];this.undo=function(){return new mindmaps.action.SetBranchColorAction(a,c)}};mindmaps.action.SetBranchColorAction.prototype=new mindmaps.action.Action;mindmaps.action.CompositeAction=function(){this.actions=[]};mindmaps.action.CompositeAction.prototype.addAction=function(a){this.actions.push(a)};
mindmaps.action.CompositeAction.prototype.forEachAction=function(a){this.actions.forEach(a)};mindmaps.action.SetChildrenBranchColorAction=function(a){mindmaps.action.CompositeAction.call(this);var b=a.branchColor,c=this;a.forEachDescendant(function(a){c.addAction(new mindmaps.action.SetBranchColorAction(a,b))})};mindmaps.action.SetChildrenBranchColorAction.prototype=new mindmaps.action.CompositeAction;mindmaps.ApplicationController=function(){function a(){(new mindmaps.SaveDocumentPresenter(d,g,new mindmaps.SaveDocumentView,h,i)).go()}function b(){g.getDocument()&&g.setDocument(null)}function c(){(new mindmaps.ExportMapPresenter(d,g,new mindmaps.ExportMapView)).go()}var d=new mindmaps.EventBus,e=new mindmaps.ShortcutController,f=new mindmaps.CommandRegistry(e),e=new mindmaps.UndoController(d,f),g=new mindmaps.MindMapModel(d,f,e);new mindmaps.ClipboardController(d,f,g);new mindmaps.HelpController(d,
f);new mindmaps.PrintController(d,f,g);var h=new mindmaps.AutoSaveController(d,g),i=new mindmaps.FilePicker(d,g);this.init=function(){var e=f.get(mindmaps.SaveDocumentCommand);e.setHandler(a);var k=f.get(mindmaps.CloseDocumentCommand);k.setHandler(b);var h=f.get(mindmaps.ExportCommand);h.setHandler(c);d.subscribe(mindmaps.Event.DOCUMENT_CLOSED,function(){e.setEnabled(!1);k.setEnabled(!1);h.setEnabled(!1)});d.subscribe(mindmaps.Event.DOCUMENT_OPENED,function(){e.setEnabled(!0);k.setEnabled(!0);h.setEnabled(!0)})};
this.go=function(){var a=(new mindmaps.MainViewController(d,g,f)).go();(new mindMapWrap.OnlineDocumentPresenter(d,g,a)).go()};this.init()};mindmaps.NavigatorView=function(){var a=this,b=$("#template-navigator").tmpl(),c=b.children(".active").hide(),d=b.children(".inactive").hide(),e=$("#navi-canvas-overlay",b),f=$("#navi-canvas",b);this.getContent=function(){return b};this.showActiveContent=function(){d.hide();c.show()};this.showInactiveContent=function(){c.hide();d.show()};this.setDraggerSize=function(a,b){e.css({width:a,height:b})};this.setDraggerPosition=function(a,b){e.css({left:a,top:b})};this.setCanvasHeight=function(a){$("#navi-canvas",
b).css({height:a})};this.getCanvasWidth=function(){return $("#navi-canvas",b).width()};this.init=function(){$("#navi-slider",b).slider({min:0,max:11,step:1,value:3,slide:function(b,c){a.sliderChanged&&a.sliderChanged(c.value)}});$("#button-navi-zoom-in",b).button({text:!1,icons:{primary:"ui-icon-zoomin"}}).click(function(){a.buttonZoomInClicked&&a.buttonZoomInClicked()});$("#button-navi-zoom-out",b).button({text:!1,icons:{primary:"ui-icon-zoomout"}}).click(function(){a.buttonZoomOutClicked&&a.buttonZoomOutClicked()});
e.draggable({containment:"parent",start:function(){a.dragStart&&a.dragStart()},drag:function(b,c){a.dragging&&a.dragging(c.position.left,c.position.top)},stop:function(){a.dragStop&&a.dragStop()}})};this.draw=function(a,b){function c(a,e,d){m.save();m.translate(e,d);a.collapseChildren||a.forEachChild(function(a){m.beginPath();m.strokeStyle=a.branchColor;m.moveTo(0,0);var e=a.offset.x/b,d=a.offset.y/b;if(0>e)var f=e+5;else f=e,e+=5;m.lineTo(f,d);m.lineTo(e,d);m.stroke();c(a,e,d)});m.restore()}var e=
a.root,d=f[0],n=d.width,l=d.height,m=d.getContext("2d");m.clearRect(0,0,n,l);m.lineWidth=1.8;c(e,n/2,l/2);m.fillRect(n/2-4,l/2-2,8,4)};this.showZoomLevel=function(a){$("#navi-zoom-level").text(a)};this.setSliderValue=function(a){$("#navi-slider").slider("value",a)}};
mindmaps.NavigatorPresenter=function(a,b,c,d){function e(){var a=h.width()/j,c=h.height()/j,a=a*k.x/n.x,c=c*k.y/n.y;a>k.x&&(a=k.x);c>k.y&&(c=k.y);b.setDraggerSize(a,c)}function f(){var a=h.scrollLeft()/j,c=h.scrollTop()/j;b.setDraggerPosition(a*k.x/n.x,c*k.y/n.y)}function g(){b.draw(l,n.x/k.x)}var h=c.getContent(),i=!1,j=d.DEFAULT_ZOOM,k=new mindmaps.Point,n=null,l=null;b.dragStart=function(){i=!0};b.dragging=function(a,b){var c=j*n.y*b/k.y;h.scrollLeft(j*n.x*a/k.x).scrollTop(c)};b.dragStop=function(){i=
!1};b.buttonZoomInClicked=function(){d.zoomIn()};b.buttonZoomOutClicked=function(){d.zoomOut()};b.sliderChanged=function(a){d.zoomTo((a+1)*d.ZOOM_STEP)};c.subscribe(mindmaps.CanvasContainer.Event.RESIZED,function(){n&&e()});a.subscribe(mindmaps.Event.DOCUMENT_OPENED,function(a){n=a.dimensions;l=a.mindmap;var a=b.getCanvasWidth(),c=n.y/(n.x/a);b.setCanvasHeight(c);k.x=a;k.y=c;f();e();b.showZoomLevel(100*j+" %");b.setSliderValue(j/d.ZOOM_STEP-1);g();b.showActiveContent();h.bind("scroll.navigator-view",
function(){i||f()})});a.subscribe(mindmaps.Event.DOCUMENT_CLOSED,function(){l=n=null;j=1;h.unbind("scroll.navigator-view");b.showInactiveContent()});a.subscribe(mindmaps.Event.NODE_MOVED,g);a.subscribe(mindmaps.Event.NODE_BRANCH_COLOR_CHANGED,g);a.subscribe(mindmaps.Event.NODE_CREATED,g);a.subscribe(mindmaps.Event.NODE_DELETED,g);a.subscribe(mindmaps.Event.NODE_OPENED,g);a.subscribe(mindmaps.Event.NODE_CLOSED,g);a.subscribe(mindmaps.Event.ZOOM_CHANGED,function(a){j=a;f();e();b.showZoomLevel(100*j+
" %");b.setSliderValue(j/d.ZOOM_STEP-1)});this.go=function(){b.init();b.showInactiveContent()}};mindmaps.AutoSaveController=function(a,b){function c(){console.debug("Autosaving...");b.saveToLocalStorage()}var d=null;this.enable=function(){d||(d=setInterval(c,6E4));b.getDocument().setAutoSave(!0)};this.disable=function(){d&&(clearInterval(d),d=null);b.getDocument().setAutoSave(!1)};this.isEnabled=function(){return b.getDocument().isAutoSave()};this.init=function(){a.subscribe(mindmaps.Event.DOCUMENT_OPENED,this.documentOpened.bind(this));a.subscribe(mindmaps.Event.DOCUMENT_CLOSED,this.documentClosed.bind(this))};
this.documentOpened=function(){this.isEnabled()&&(d||(d=setInterval(c,6E4)))};this.documentClosed=function(){d&&(clearInterval(d),d=null)};this.init()};mindmaps.NewDocumentView=function(){};mindmaps.NewDocumentPresenter=function(a,b){this.go=function(){var a=new mindmaps.Document;b.setDocument(a)}};mindmaps.CanvasDrawingUtil={getLineWidth:function(a,b){var c=a*(12-2*b);2>c&&(c=2);return c},roundedRect:function(a,b,c,d,e,f){a.beginPath();a.moveTo(b,c+f);a.lineTo(b,c+e-f);a.quadraticCurveTo(b,c+e,b+f,c+e);a.lineTo(b+d-f,c+e);a.quadraticCurveTo(b+d,c+e,b+d,c+e-f);a.lineTo(b+d,c+f);a.quadraticCurveTo(b+d,c,b+d-f,c);a.lineTo(b+f,c);a.quadraticCurveTo(b,c,b,c+f);a.stroke();a.fill()}};
mindmaps.CanvasBranchDrawer=function(){this.beforeDraw=function(){};this.render=function(a,b,c,d,e,f,g,h){var c=c*h,d=d*h,i=f.width(),j=e.width(),k=f.innerHeight(),n=e.innerHeight(),l=!1,m,p;c+j/2<i/2?(i=Math.abs(c),i>j?(p=i-j+1,m=j,j=!0):(m=-c,p=j+c,j=!1,l=!0)):c>i?(p=c-i+1,m=i-c,j=!1):(p=i-c,m=0,l=j=!0);c=mindmaps.CanvasDrawingUtil.getLineWidth(h,b);i=c/2;p<c&&(p=c);d+n<k?(k=n,e=f.outerHeight()-d-k,f=!0):(k-=d,e=e.outerHeight()-k,f=!1);this.beforeDraw(p,e,m,k);j?d=0:(d=p,p=0);h=(mindmaps.CanvasDrawingUtil.getLineWidth(h,
b-1)-c)/2;f?(b=0+i,h=e-i-h):(b=e-i,h=0+i+h);l?(j?(d+=i,p-=i):(d-=i,p+=i),j=d,e=Math.abs(b-h)/2,l=p,i=b>h?b/5:h-h/5):(l=d>p?d/5:p-p/5,i=h,j=j?Math.abs(d-p):0,e=b);a.lineWidth=c;a.strokeStyle=g;a.fillStyle=g;a.beginPath();a.moveTo(d,b);a.bezierCurveTo(j,e,l,i,p,h);a.stroke()}};
mindmaps.TextMetrics=function(){var a=$("<div/>",{"class":"node-text-behaviour"}).css({position:"absolute",visibility:"hidden",height:"auto",width:"auto"}).prependTo($("body"));return{ROOT_CAPTION_MIN_WIDTH:100,NODE_CAPTION_MIN_WIDTH:70,NODE_CAPTION_MAX_WIDTH:150,getTextMetrics:function(b,c,d){var c=c||1,d=d||b.getCaption(),e=b.text.font,b=b.isRoot()?this.ROOT_CAPTION_MIN_WIDTH:this.NODE_CAPTION_MIN_WIDTH;a.css({"font-size":c*e.size,"min-width":c*b,"max-width":c*this.NODE_CAPTION_MAX_WIDTH,"font-weight":e.weight}).text(d);
c=a.width()+2;d=a.height()+2;return{width:c,height:d}}}}();mindmaps.Node=function(){this.id=mindmaps.Util.getId();this.parent=null;this.children=new mindmaps.NodeMap;this.text={caption:"New Idea",font:{style:"normal",weight:"normal",decoration:"none",size:15,color:"#000000"}};this.offset=new mindmaps.Point;this.foldChildren=!1;this.branchColor="#000000"};
mindmaps.Node.prototype.clone=function(){var a=new mindmaps.Node,b={caption:this.text.caption};b.font={weight:this.text.font.weight,style:this.text.font.style,decoration:this.text.font.decoration,size:this.text.font.size,color:this.text.font.color};a.text=b;a.offset=this.offset.clone();a.foldChildren=this.foldChildren;a.branchColor=this.branchColor;this.forEachChild(function(b){b=b.clone();a.addChild(b)});return a};mindmaps.Node.fromJSON=function(a){return mindmaps.Node.fromObject(JSON.parse(a))};
mindmaps.Node.fromObject=function(a){var b=new mindmaps.Node;b.id=a.id;b.text=a.text;b.offset=mindmaps.Point.fromObject(a.offset);b.foldChildren=a.foldChildren;b.branchColor=a.branchColor;a.children.forEach(function(a){a=mindmaps.Node.fromObject(a);b.addChild(a)});return b};
mindmaps.Node.prototype.toJSON=function(){var a=[];this.forEachChild(function(b){a.push(b.toJSON())});return{id:this.id,parentId:this.parent?this.parent.id:null,text:this.text,offset:this.offset,foldChildren:this.foldChildren,branchColor:this.branchColor,children:a}};mindmaps.Node.prototype.serialize=function(){return JSON.stringify(this)};mindmaps.Node.prototype.addChild=function(a){a.parent=this;this.children.add(a)};mindmaps.Node.prototype.removeChild=function(a){a.parent=null;this.children.remove(a)};
mindmaps.Node.prototype.isRoot=function(){return null===this.parent};mindmaps.Node.prototype.isLeaf=function(){return 0===this.children.size()};mindmaps.Node.prototype.getParent=function(){return this.parent};mindmaps.Node.prototype.getRoot=function(){for(var a=this;a.parent;)a=a.parent;return a};mindmaps.Node.prototype.getPosition=function(){for(var a=this.offset.clone(),b=this.parent;b;)a.add(b.offset),b=b.parent;return a};
mindmaps.Node.prototype.getDepth=function(){for(var a=this.parent,b=0;a;)b++,a=a.parent;return b};mindmaps.Node.prototype.getChildren=function(a){var b=[];this.children.each(function(c){a&&c.getChildren(!0).forEach(function(a){b.push(a)});b.push(c)});return b};mindmaps.Node.prototype.forEachChild=function(a){this.children.each(a)};mindmaps.Node.prototype.forEachDescendant=function(a){this.children.each(function(b){a(b);b.forEachDescendant(a)})};
mindmaps.Node.prototype.setCaption=function(a){this.text.caption=a};mindmaps.Node.prototype.getCaption=function(){return this.text.caption};mindmaps.Node.prototype.isDescendant=function(a){function b(c){for(var c=c.children.values(),d=0,e=c.length;d<e;d++){var f=c[d];if(b(f)||f===a)return!0}return!1}return b(this)};mindmaps.CanvasPresenter=function(a,b,c,d,e){var f=d.getCreator();this.init=function(){b.get(mindmaps.EditNodeCaptionCommand).setHandler(this.editNodeCaption.bind(this));b.get(mindmaps.ToggleNodeFoldedCommand).setHandler(g)};this.editNodeCaption=function(a){a||(a=c.selectedNode);d.editNodeCaption(a)};var g=function(a){a||(a=c.selectedNode);a=new mindmaps.action.ToggleNodeFoldAction(a);c.executeAction(a)};d.mouseWheeled=function(a){d.stopEditNodeCaption();0<a?e.zoomIn():e.zoomOut()};d.nodeMouseOver=
function(a){!d.isNodeDragging()&&!f.isDragging()&&f.attachToNode(a)};d.nodeCaptionMouseOver=function(a){!d.isNodeDragging()&&!f.isDragging()&&f.attachToNode(a)};d.nodeMouseDown=function(a){c.selectNode(a);f.attachToNode(a)};d.nodeDoubleClicked=function(a){d.editNodeCaption(a)};d.nodeDragged=function(a,b){var e=new mindmaps.action.MoveNodeAction(a,b);c.executeAction(e)};d.foldButtonClicked=function(a){g(a)};f.dragStarted=function(a){return a.isRoot()?mindmaps.Util.randomColor():a.branchColor};f.dragStopped=
function(a,b,e,d){50>d||(d=new mindmaps.Node,d.branchColor=f.lineColor,d.offset=new mindmaps.Point(b,e),d.shouldEditCaption=!0,c.createNode(d,a))};d.nodeCaptionEditCommitted=function(a,b){if(b=$.trim(b))d.stopEditNodeCaption(),c.changeNodeCaption(a,b)};this.go=function(){d.init()};a.subscribe(mindmaps.Event.DOCUMENT_OPENED,function(a){d.setZoomFactor(e.DEFAULT_ZOOM);var b=a.dimensions;d.setDimensions(b.x,b.y);a=a.mindmap;d.drawMap(a);d.center();c.selectNode(a.root)});a.subscribe(mindmaps.Event.DOCUMENT_CLOSED,
function(){d.clear()});a.subscribe(mindmaps.Event.NODE_MOVED,function(a){d.positionNode(a)});a.subscribe(mindmaps.Event.NODE_TEXT_CAPTION_CHANGED,function(a){d.setNodeText(a,a.getCaption());d.redrawNodeConnectors(a)});a.subscribe(mindmaps.Event.NODE_CREATED,function(a){d.createNode(a);if(a.shouldEditCaption){delete a.shouldEditCaption;var b=a.getParent();b.foldChildren&&(b=new mindmaps.action.OpenNodeAction(b),c.executeAction(b));c.selectNode(a);f.attachToNode(a);d.editNodeCaption(a)}});a.subscribe(mindmaps.Event.NODE_DELETED,
function(a,b){var e=c.selectedNode;(a===e||a.isDescendant(e))&&c.selectNode(b);d.deleteNode(a);b.isLeaf()&&d.removeFoldButton(b)});a.subscribe(mindmaps.Event.NODE_SELECTED,function(a,b){b&&d.unhighlightNode(b);d.highlightNode(a)});a.subscribe(mindmaps.Event.NODE_OPENED,function(a){d.openNode(a)});a.subscribe(mindmaps.Event.NODE_CLOSED,function(a){d.closeNode(a)});a.subscribe(mindmaps.Event.NODE_FONT_CHANGED,function(a){d.updateNode(a)});a.subscribe(mindmaps.Event.NODE_FONT_COLOR_PREVIEW,function(a,
b){d.updateFontColor(a,b)});a.subscribe(mindmaps.Event.NODE_BRANCH_COLOR_CHANGED,function(a){d.updateNode(a)});a.subscribe(mindmaps.Event.NODE_BRANCH_COLOR_PREVIEW,function(a,b){d.updateBranchColor(a,b)});a.subscribe(mindmaps.Event.ZOOM_CHANGED,function(a){d.setZoomFactor(a);d.applyViewZoom();d.scaleMap()});this.init()};mindmaps.NodeMap=function(){this.nodes={};this.count=0};mindmaps.NodeMap.prototype.get=function(a){return this.nodes[a]};mindmaps.NodeMap.prototype.add=function(a){return!this.nodes.hasOwnProperty(a.id)?(this.nodes[a.id]=a,this.count++,!0):!1};mindmaps.NodeMap.prototype.remove=function(a){return this.nodes.hasOwnProperty(a.id)?(delete this.nodes[a.id],this.count--,!0):!1};mindmaps.NodeMap.prototype.size=function(){return this.count};
mindmaps.NodeMap.prototype.values=function(){return Object.keys(this.nodes).map(function(a){return this.nodes[a]},this)};mindmaps.NodeMap.prototype.each=function(a){for(var b in this.nodes)a(this.nodes[b])};mindmaps.CanvasView=function(){this.$getDrawingArea=function(){return $("#drawing-area")};this.$getContainer=function(){return $("#canvas-container")};this.center=function(){var a=this.$getContainer(),b=this.$getDrawingArea(),c=b.width()-a.width(),a=b.height()-a.height();this.scroll(c/2,a/2)};this.scroll=function(a,b){this.$getContainer().scrollLeft(a).scrollTop(b)};this.applyViewZoom=function(){var a=this.zoomFactorDelta,b=this.$getContainer(),c=b.scrollLeft(),d=b.scrollTop(),e=b.width(),b=b.height(),
c=(e/2+c)*this.zoomFactorDelta,d=(b/2+d)*this.zoomFactorDelta,c=c-e/2,d=d-b/2,e=this.$getDrawingArea(),b=e.width(),f=e.height();e.width(b*a).height(f*a);this.scroll(c,d);c=parseFloat(e.css("background-size"));isNaN(c)&&console.warn("Could not set background-size!");e.css("background-size",c*a)};this.setDimensions=function(a,b){a*=this.zoomFactor;b*=this.zoomFactor;this.$getDrawingArea().width(a).height(b)};this.setZoomFactor=function(a){this.zoomFactorDelta=a/(this.zoomFactor||1);this.zoomFactor=
a}};mindmaps.CanvasView.prototype.drawMap=function(){throw Error("Not implemented");};
mindmaps.DefaultCanvasView=function(){function a(a){return $("#node-"+a.id)}function b(a){return $("#node-caption-"+a.id)}function c(a,b,c,d,f,g,h){var i=a[0].getContext("2d");j.$canvas=a;j.render(i,b,c,d,f,g,h,e.zoomFactor)}function d(b,e){var d=b.getParent(),f=b.getDepth(),g=b.offset.x,h=b.offset.y,e=e||b.branchColor,i=a(b),d=a(d),j=$("#node-canvas-"+b.id);c(j,f,g,h,i,d,e)}var e=this,f=!1,g=new function(b){var e=this,d=!1;this.lineColor=this.node=null;var f=$("<div/>",{id:"creator-wrapper"}).bind("remove",
function(a){e.detach();a.stopImmediatePropagation();console.debug("creator detached.");return!1}),g=$("<div/>",{id:"creator-nub"}).appendTo(f),h=$("<div/>",{id:"creator-fakenode"}).appendTo(g),i=$("<canvas/>",{id:"creator-canvas","class":"line-canvas"}).hide().appendTo(f);f.draggable({revert:!0,revertDuration:0,start:function(){d=!0;i.show();e.dragStarted&&(e.lineColor=e.dragStarted(e.node))},drag:function(d,f){var g=f.position.left/b.zoomFactor,m=f.position.top/b.zoomFactor,l=a(e.node);c(i,e.depth+
1,g,m,h,l,e.lineColor)},stop:function(a,c){d=!1;i.hide();if(e.dragStopped){var g=f.position(),h=c.position.left/b.zoomFactor,j=c.position.top/b.zoomFactor,g=mindmaps.Util.distance(g.left/b.zoomFactor-h,g.top/b.zoomFactor-j);e.dragStopped(e.node,h,j,g)}f.css({left:"",top:""})}});this.attachToNode=function(c){if(this.node!==c){this.node=c;f.removeClass("left right");0<c.offset.x?f.addClass("right"):0>c.offset.x&&f.addClass("left");this.depth=c.getDepth();var e=b.getLineWidth(this.depth+1);h.css("border-bottom-width",
e);c=a(c);f.appendTo(c)}};this.detach=function(){f.detach();this.node=null};this.isDragging=function(){return d}}(this),h=new function(a){function c(){f&&d.commit&&d.commit(d.node,g.val())}function e(){setTimeout(function(){a.redrawNodeConnectors(d.node)},1)}var d=this,f=!1,g=$("<textarea/>",{id:"caption-editor","class":"node-text-behaviour"}).bind("keydown","esc",function(){d.stop()}).bind("keydown","return",function(){c()}).mousedown(function(a){a.stopPropagation()}).blur(function(){c()}).bind("input",
function(){var b=i.getTextMetrics(d.node,a.zoomFactor,g.val());g.css(b);e()});this.edit=function(e,h){if(!f){this.node=e;f=!0;this.$text=b(e);this.$cancelArea=h;this.text=this.$text.text();this.$text.css({width:"auto",height:"auto"}).empty().addClass("edit");h.bind("mousedown.editNodeCaption",function(){c()});var l=i.getTextMetrics(d.node,a.zoomFactor,this.text);g.attr({value:this.text}).css(l).appendTo(this.$text).select()}};this.stop=function(){f&&(f=!1,this.$text.removeClass("edit"),g.detach(),
this.$cancelArea.unbind("mousedown.editNodeCaption"),a.setNodeText(this.node,this.text),e())}}(this);h.commit=function(a,b){e.nodeCaptionEditCommitted&&e.nodeCaptionEditCommitted(a,b)};var i=mindmaps.TextMetrics,j=new mindmaps.CanvasBranchDrawer;j.beforeDraw=function(a,b,c,e){this.$canvas.attr({width:a,height:b}).css({left:c,top:e})};this.init=function(){e.$getContainer().dragscrollable({dragSelector:"#drawing-area, canvas.line-canvas",acceptPropagatedEvent:!1,delegateMode:!0,preventDefault:!0});
this.center();var a=this.$getDrawingArea();a.addClass("mindmap");a.delegate("div.node-caption","mousedown",function(){var a=$(this).parent().data("node");e.nodeMouseDown&&e.nodeMouseDown(a)});a.delegate("div.node-caption","mouseup",function(){var a=$(this).parent().data("node");e.nodeMouseUp&&e.nodeMouseUp(a)});a.delegate("div.node-caption","dblclick",function(){var a=$(this).parent().data("node");e.nodeDoubleClicked&&e.nodeDoubleClicked(a)});a.delegate("div.node-container","mouseover",function(a){a.target===
this&&(a=$(this).data("node"),e.nodeMouseOver&&e.nodeMouseOver(a));return!1});a.delegate("div.node-caption","mouseover",function(a){a.target===this&&(a=$(this).parent().data("node"),e.nodeCaptionMouseOver&&e.nodeCaptionMouseOver(a));return!1});this.$getContainer().bind("mousewheel",function(a,b){e.mouseWheeled&&e.mouseWheeled(b)})};this.clear=function(){var a=this.$getDrawingArea();a.children().remove();a.width(0).height(0)};this.getLineWidth=function(a){return mindmaps.CanvasDrawingUtil.getLineWidth(this.zoomFactor,
a)};this.drawMap=function(a){var b=(new Date).getTime(),c=this.$getDrawingArea();c.children().remove();e.createNode(a.root,c);console.debug("draw map ms: ",(new Date).getTime()-b)};this.createNode=function(a,b,c){this.createNodeNoRender(a,b,c);this.nodeRendering(a,b,c)};this.createNodeNoRender=function(b,c,e){var d=b.getParent(),c=c||a(d),e=e||b.getDepth(),f=$("<div/>",{id:"node-"+b.id,"class":"node-container"}).data({node:b}).css({"font-size":b.text.font.size});f.appendTo(c);if(b.isRoot()){var g=
this.getLineWidth(e);f.css("border-bottom-width",g)}b.isRoot()||(e=this.getLineWidth(e),f.css({"border-bottom":e+"px solid "+b.branchColor}));e=b.text.font;e=$("<div/>",{id:"node-caption-"+b.id,"class":"node-caption node-text-behaviour",text:b.text.caption}).css({color:e.color,"font-size":100*this.zoomFactor+"%","font-weight":e.weight,"font-style":e.style,"text-decoration":e.decoration}).appendTo(f);g=i.getTextMetrics(b,this.zoomFactor);e.css(g);c=c.data("foldButton");e=b.isRoot()||d.isRoot();!c&&
!e&&this.createFoldButton(d);b.isRoot()&&f.children().andSelf().addClass("root")};this.nodeRendering=function(d,g,h){var i=d.getParent(),g=g||a(i),h=h||d.getDepth(),j=d.offset.x,r=d.offset.y,q=a(d);d.isRoot()||(this.getLineWidth(h),q.css({left:this.zoomFactor*j,top:this.zoomFactor*r}),q.one("mouseenter",function(){q.draggable({handle:"div.node-caption:first",start:function(){f=!0},drag:function(a,b){var f=b.position.left/e.zoomFactor,i=b.position.top/e.zoomFactor,j=d.branchColor,m=$("#node-canvas-"+
d.id);c(m,h,f,i,q,g,j);e.nodeDragging&&e.nodeDragging()},stop:function(a,b){f=!1;var c=new mindmaps.Point(b.position.left/e.zoomFactor,b.position.top/e.zoomFactor);e.nodeDragged&&e.nodeDragged(d,c)}})}));b(d);d.isRoot()||(i.foldChildren?q.hide():q.show(),i=$("<canvas/>",{id:"node-canvas-"+d.id,"class":"line-canvas"}),c(i,h,j,r,q,g,d.branchColor),i.appendTo(q))};this.deleteNode=function(b){a(b).remove()};this.highlightNode=function(a){b(a).addClass("selected")};this.unhighlightNode=function(a){b(a).removeClass("selected")};
this.closeNode=function(b){b=a(b);b.children(".node-container").hide();b.children(".button-fold").first().removeClass("open").addClass("closed")};this.openNode=function(b){b=a(b);b.children(".node-container").show();b.children(".button-fold").first().removeClass("closed").addClass("open")};this.createFoldButton=function(b){var c=$("<div/>",{"class":"button-fold no-select"+(b.foldChildren?" closed":" open")+(0<b.offset.x?" right":" left")}).click(function(a){e.foldButtonClicked&&e.foldButtonClicked(b);
a.preventDefault();return!1});a(b).data({foldButton:!0}).append(c)};this.removeFoldButton=function(b){a(b).data({foldButton:!1}).children(".button-fold").remove()};this.editNodeCaption=function(a){h.edit(a,this.$getDrawingArea())};this.stopEditNodeCaption=function(){h.stop()};this.setNodeText=function(a,c){var e=b(a),d=i.getTextMetrics(a,this.zoomFactor,c);e.css(d).text(c)};this.getCreator=function(){return g};this.isNodeDragging=function(){return f};this.redrawNodeConnectors=function(a){a.isRoot()||
d(a);a.isLeaf()||a.forEachChild(function(a){d(a)})};this.updateBranchColor=function(b,c){a(b).css("border-bottom-color",c);b.isRoot()||d(b,c)};this.updateFontColor=function(a,c){b(a).css("color",c)};this.updateNode=function(c){var e=a(c),d=b(c),f=c.text.font;e.css({"font-size":f.size,"border-bottom-color":c.branchColor});e=i.getTextMetrics(c,this.zoomFactor);d.css({color:f.color,"font-weight":f.weight,"font-style":f.style,"text-decoration":f.decoration}).css(e);this.redrawNodeConnectors(c)};this.positionNode=
function(b){a(b).css({left:this.zoomFactor*b.offset.x,top:this.zoomFactor*b.offset.y});d(b)};this.scaleMap=function(){function c(g,h){var j=a(g),m=e.getLineWidth(h);j.css({left:f*g.offset.x,top:f*g.offset.y,"border-bottom-width":m});j=b(g);j.css({"font-size":100*f+"%"});m=i.getTextMetrics(g,e.zoomFactor);j.css(m);d(g);g.isLeaf()||g.forEachChild(function(a){c(a,h+1)})}var f=this.zoomFactor,g=this.$getDrawingArea().children().first(),h=g.data("node"),j=this.getLineWidth(0);g.css("border-bottom-width",
j);g=b(h);j=i.getTextMetrics(h,this.zoomFactor);g.css({"font-size":100*f+"%",left:f*-mindmaps.TextMetrics.ROOT_CAPTION_MIN_WIDTH/2}).css(j);h.forEachChild(function(a){c(a,1)})}};mindmaps.DefaultCanvasView.prototype=new mindmaps.CanvasView;mindmaps.Notification=function(a,b){var c=this,b=$.extend({},mindmaps.Notification.Defaults,b),d=this.$el=$("#template-notification").tmpl(b).css({"max-width":b.maxWidth}).addClass(b.type),e=$(a);if(0===e.length)return this;var f=e.offset(),g=f.left,f=f.top,h=e.outerWidth(),e=e.outerHeight();d.appendTo($("body"));var i=d.outerWidth(),j=d.outerHeight(),k,n,l=b.padding;switch(b.position){case "topLeft":n=f-l-j;k=g;break;case "topMiddle":n=f-l-j;k=i<h?g+(h-i)/2:g-(i-h)/2;break;case "topRight":n=f-l-
j;k=g+h-i;break;case "rightTop":n=f;break;case "rightMiddle":n=j<e?f+(e-j)/2:f-(j-e)/2;k=g+l+h;break;case "rightBottom":n=f+e-j;k=g+l+h;break;case "bottomLeft":n=f+l+e;k=g;break;case "bottomMiddle":n=f+l+e;k=i<h?g+(h-i)/2:g-(i-h)/2;break;case "bottomRight":n=f+l+e;k=g+h-i;break;case "leftTop":n=f;k=g-l-i;break;case "leftMiddle":n=j<e?f+(e-j)/2:f-(j-e)/2;k=g-l-i;break;case "leftBottom":n=f+e-j,k=g-l-i}d.offset({left:k,top:n});b.expires&&setTimeout(function(){c.close()},b.expires);b.closeButton&&d.find(".close-button").click(function(){c.close()});
d.fadeIn(600)};mindmaps.Notification.prototype={close:function(){var a=this.$el;a.fadeOut(800,function(){a.remove();this.removed=!0})},isVisible:function(){return!this.removed},$:function(){return this.$el}};mindmaps.Notification.Defaults={title:null,content:"New Notification",position:"topLeft",padding:10,expires:0,closeButton:!1,maxWidth:500,type:"info"};mindmaps.ClipboardController=function(a,b,c){var d,e,f,g;e=b.get(mindmaps.CopyNodeCommand);e.setHandler(function(){d=c.selectedNode.clone();g.setEnabled(!0)});f=b.get(mindmaps.CutNodeCommand);f.setHandler(function(){d=c.selectedNode.clone();g.setEnabled(!0);c.deleteNode(c.selectedNode)});g=b.get(mindmaps.PasteNodeCommand);g.setHandler(function(){d&&c.createNode(d.clone(),c.selectedNode)});g.setEnabled(!1);a.subscribe(mindmaps.Event.DOCUMENT_CLOSED,function(){e.setEnabled(!1);f.setEnabled(!1);g.setEnabled(!1)});
a.subscribe(mindmaps.Event.DOCUMENT_OPENED,function(){e.setEnabled(!0);f.setEnabled(!0);g.setEnabled(null!=d)})};mindmaps.Command=function(){this.id="BASE_COMMAND";this.description=this.label=this.handler=this.shortcut=null;this.enabled=!1};mindmaps.Command.Event={HANDLER_REGISTERED:"HandlerRegisteredCommandEvent",HANDLER_REMOVED:"HandlerRemovedCommandEvent",ENABLED_CHANGED:"EnabledChangedCommandEvent"};
mindmaps.Command.prototype={execute:function(){this.handler?(this.handler(),mindmaps.DEBUG&&console.log("handler called for",this.id)):mindmaps.DEBUG&&console.log("no handler found for",this.id)},setHandler:function(a){this.removeHandler();this.handler=a;this.publish(mindmaps.Command.Event.HANDLER_REGISTERED)},removeHandler:function(){this.handler=null;this.publish(mindmaps.Command.Event.HANDLER_REMOVED)},setEnabled:function(a){this.enabled=a;this.publish(mindmaps.Command.Event.ENABLED_CHANGED,a)}};
EventEmitter.mixin(mindmaps.Command);mindmaps.CreateNodeCommand=function(){this.id="CREATE_NODE_COMMAND";this.shortcut="tab";this.label="Add";this.icon="ui-icon-plusthick";this.description="Creates a new node"};mindmaps.CreateNodeCommand.prototype=new mindmaps.Command;mindmaps.CreateSiblingNodeCommand=function(){this.id="CREATE_SIBLING_NODE_COMMAND";this.shortcut="shift+tab";this.label="Add";this.icon="ui-icon-plusthick";this.description="Creates a new sibling node"};
mindmaps.CreateSiblingNodeCommand.prototype=new mindmaps.Command;mindmaps.DeleteNodeCommand=function(){this.id="DELETE_NODE_COMMAND";this.shortcut=["del","backspace"];this.label="Delete";this.icon="ui-icon-minusthick";this.description="Deletes a new node"};mindmaps.DeleteNodeCommand.prototype=new mindmaps.Command;mindmaps.EditNodeCaptionCommand=function(){this.id="EDIT_NODE_CAPTION_COMMAND";this.shortcut=["F2","return"];this.label="Edit node caption";this.description="Edits the node text"};
mindmaps.EditNodeCaptionCommand.prototype=new mindmaps.Command;mindmaps.ToggleNodeFoldedCommand=function(){this.id="TOGGLE_NODE_FOLDED_COMMAND";this.shortcut="space";this.description="Show or hide the node's children"};mindmaps.ToggleNodeFoldedCommand.prototype=new mindmaps.Command;mindmaps.UndoCommand=function(){this.id="UNDO_COMMAND";this.shortcut=["ctrl+z","meta+z"];this.label="Undo";this.icon="ui-icon-arrowreturnthick-1-w";this.description="Undo"};mindmaps.UndoCommand.prototype=new mindmaps.Command;
mindmaps.RedoCommand=function(){this.id="REDO_COMMAND";this.shortcut=["ctrl+y","meta+shift+z"];this.label="Redo";this.icon="ui-icon-arrowreturnthick-1-e";this.description="Redo"};mindmaps.RedoCommand.prototype=new mindmaps.Command;mindmaps.CopyNodeCommand=function(){this.id="COPY_COMMAND";this.shortcut=["ctrl+c","meta+c"];this.label="Copy";this.icon="ui-icon-copy";this.description="Copy a branch"};mindmaps.CopyNodeCommand.prototype=new mindmaps.Command;
mindmaps.CutNodeCommand=function(){this.id="CUT_COMMAND";this.shortcut=["ctrl+x","meta+x"];this.label="Cut";this.icon="ui-icon-scissors";this.description="Cut a branch"};mindmaps.CutNodeCommand.prototype=new mindmaps.Command;mindmaps.PasteNodeCommand=function(){this.id="PASTE_COMMAND";this.shortcut=["ctrl+v","meta+v"];this.label="Paste";this.icon="ui-icon-clipboard";this.description="Paste a branch"};mindmaps.PasteNodeCommand.prototype=new mindmaps.Command;
mindmaps.NewDocumentCommand=function(){this.id="NEW_DOCUMENT_COMMAND";this.label="New";this.icon="ui-icon-document-b";this.description="Start working on a new mind map"};mindmaps.NewDocumentCommand.prototype=new mindmaps.Command;mindmaps.OpenDocumentCommand=function(){this.id="OPEN_DOCUMENT_COMMAND";this.label="Open...";this.shortcut=["ctrl+o","meta+o"];this.icon="ui-icon-folder-open";this.description="Open an existing mind map"};mindmaps.OpenDocumentCommand.prototype=new mindmaps.Command;
mindmaps.SaveDocumentCommand=function(){this.id="SAVE_DOCUMENT_COMMAND";this.label="Save...";this.shortcut=["ctrl+s","meta+s"];this.icon="ui-icon-disk";this.description="Save the mind map"};mindmaps.SaveDocumentCommand.prototype=new mindmaps.Command;mindmaps.CloseDocumentCommand=function(){this.id="CLOSE_DOCUMENT_COMMAND";this.label="Close";this.icon="ui-icon-close";this.description="Close the mind map"};mindmaps.CloseDocumentCommand.prototype=new mindmaps.Command;
mindmaps.HelpCommand=function(){this.id="HELP_COMMAND";this.enabled=!0;this.icon="ui-icon-help";this.label="Help";this.shortcut="F1";this.description="Get help!"};mindmaps.HelpCommand.prototype=new mindmaps.Command;mindmaps.PrintCommand=function(){this.id="PRINT_COMMAND";this.icon="ui-icon-print";this.label="Print";this.shortcut=["ctrl+p","meta+p"];this.description="Print the mind map"};mindmaps.PrintCommand.prototype=new mindmaps.Command;
mindmaps.ExportCommand=function(){this.id="EXPORT_COMMAND";this.icon="ui-icon-image";this.label="Export As Image...";this.description="Export the mind map"};mindmaps.ExportCommand.prototype=new mindmaps.Command;mindmaps.OpenDocumentView=function(){var a=this,b=$("#template-open").tmpl().dialog({autoOpen:!1,modal:!0,zIndex:5E3,width:550,close:function(){$(this).dialog("destroy");$(this).remove()}});$("#button-open-cloud").button().click(function(){a.openCloudButtonClicked&&a.openCloudButtonClicked()});b.find(".file-chooser input").bind("change",function(b){a.openExernalFileClicked&&a.openExernalFileClicked(b)});b.find(".localstorage-filelist").delegate("a.title","click",function(){if(a.documentClicked){var b=
$(this).tmplItem();a.documentClicked(b.data)}}).delegate("a.delete","click",function(){if(a.deleteDocumentClicked){var b=$(this).tmplItem();a.deleteDocumentClicked(b.data)}});this.render=function(a){var d=$(".document-list",b).empty();$("#template-open-table-item").tmpl(a,{format:function(a){if(!a)return"";var b=a.getDate(),c=a.getMonth()+1,a=a.getFullYear();return b+"/"+c+"/"+a}}).appendTo(d)};this.showOpenDialog=function(a){this.render(a);b.dialog("open")};this.hideOpenDialog=function(){b.dialog("close")};
this.showCloudError=function(a){b.find(".cloud-loading").removeClass("loading");b.find(".cloud-error").text(a)};this.showCloudLoading=function(){b.find(".cloud-error").text("");b.find(".cloud-loading").addClass("loading")};this.hideCloudLoading=function(){b.find(".cloud-loading").removeClass("loading")}};
mindmaps.OpenDocumentPresenter=function(a,b,c,d){c.openCloudButtonClicked=function(){mindmaps.Util.trackEvent("Clicks","cloud-open");d.open({load:function(){c.showCloudLoading()},success:function(){c.hideOpenDialog()},error:function(a){c.showCloudError(a)}})};c.openExernalFileClicked=function(e){mindmaps.Util.trackEvent("Clicks","hdd-open");var e=e.target.files[0],d=new FileReader;d.onload=function(){try{var e=mindmaps.Document.fromJSON(d.result)}catch(h){throw a.publish(mindmaps.Event.NOTIFICATION_ERROR,
"File is not a valid mind map!"),Error("Error while opening map from hdd",h);}b.setDocument(e);c.hideOpenDialog()};d.readAsText(e)};c.documentClicked=function(a){mindmaps.Util.trackEvent("Clicks","localstorage-open");b.setDocument(a);c.hideOpenDialog()};c.deleteDocumentClicked=function(a){mindmaps.LocalDocumentStorage.deleteDocument(a);a=mindmaps.LocalDocumentStorage.getDocuments();c.render(a)};this.go=function(){var a=mindmaps.LocalDocumentStorage.getDocuments();a.sort(mindmaps.Document.sortByModifiedDateDescending);
c.showOpenDialog(a)}};mindmaps.CommandRegistry=function(a){this.commands={};this.get=function(b){var c=this.commands[b];c||(c=new b,this.commands[b]=c,a&&c.shortcut&&c.execute&&a.register(c.shortcut,c.execute.bind(c)));return c};this.remove=function(b){var c=this.commands[b];c&&(delete this.commands[b],a&&c.shortcut&&a.unregister(c.shortcut))}};mindmaps.Point=function(a,b){this.x=a||0;this.y=b||0};mindmaps.Point.fromObject=function(a){return new mindmaps.Point(a.x,a.y)};mindmaps.Point.prototype.clone=function(){return new mindmaps.Point(this.x,this.y)};mindmaps.Point.prototype.add=function(a){this.x+=a.x;this.y+=a.y};mindmaps.Point.prototype.toString=function(){return"{x: "+this.x+" y: "+this.y+"}"};mindmaps.Document=function(a){this.id=mindmaps.Util.createUUID();this.title="New Document";this.mindmap=new mindmaps.MindMap(a);this.dates={created:new Date,modified:null};this.dimensions=new mindmaps.Point(4E3,2E3);this.autosave=!1};mindmaps.Document.fromJSON=function(a){return mindmaps.Document.fromObject(JSON.parse(a))};
mindmaps.Document.fromObject=function(a){var b=new mindmaps.Document;b.id=a.id;b.title=a.title;b.mindmap=mindmaps.MindMap.fromObject(a.mindmap);b.dates={created:new Date(a.dates.created),modified:a.dates.modified?new Date(a.dates.modified):null};b.dimensions=mindmaps.Point.fromObject(a.dimensions);b.autosave=a.autosave;return b};
mindmaps.Document.prototype.toJSON=function(){var a={created:this.dates.created.getTime()};this.dates.modified&&(a.modified=this.dates.modified.getTime());return{id:this.id,title:this.title,mindmap:this.mindmap,dates:a,dimensions:this.dimensions,autosave:this.autosave}};mindmaps.Document.prototype.serialize=function(){return JSON.stringify(this)};mindmaps.Document.prototype.prepareSave=function(){this.dates.modified=new Date;this.title=this.mindmap.getRoot().getCaption();return this};
mindmaps.Document.sortByModifiedDateDescending=function(a,b){return a.dates.modified>b.dates.modified?-1:a.dates.modified<b.dates.modified?1:0};mindmaps.Document.prototype.isNew=function(){return null===this.dates.modified};mindmaps.Document.prototype.getCreatedDate=function(){return this.dates.created};mindmaps.Document.prototype.getWidth=function(){return this.dimensions.x};mindmaps.Document.prototype.getHeight=function(){return this.dimensions.y};mindmaps.Document.prototype.isAutoSave=function(){return this.autosave};
mindmaps.Document.prototype.setAutoSave=function(a){this.autosave=a};mindmaps.PrintController=function(a,b,c){var d=b.get(mindmaps.PrintCommand);d.setHandler(function(){var a=e.renderAsPNG(c.getDocument());$("#print-area").html(a);window.print()});var e=new mindmaps.StaticCanvasRenderer;a.subscribe(mindmaps.Event.DOCUMENT_CLOSED,function(){d.setEnabled(!1)});a.subscribe(mindmaps.Event.DOCUMENT_OPENED,function(){d.setEnabled(!0)})};mindmaps.Event={DOCUMENT_OPENED:"DocumentOpenedEvent",DOCUMENT_SAVED:"DocumentSavedEvent",DOCUMENT_CLOSED:"DocumentClosedEvent",NODE_SELECTED:"NodeSelectedEvent",NODE_DESELECTED:"NodeDeselectedEvent",NODE_MOVED:"NodeMovedEvent",NODE_TEXT_CAPTION_CHANGED:"NodeTextCaptionChangedEvent",NODE_FONT_CHANGED:"NodeFontChangedEvent",NODE_FONT_COLOR_PREVIEW:"NodeFontColorPreviewEvent",NODE_BRANCH_COLOR_CHANGED:"NodeBranchColorChangedEvent",NODE_BRANCH_COLOR_PREVIEW:"NodeBranchColorPreviewEvent",NODE_CREATED:"NodeCreatedEvent",
NODE_CREATED_NO_RENDER:"NodeCreateNoRender",NODE_RENDERING:"NodeRendering",NODE_DELETED:"NodeDeletedEvent",NODE_OPENED:"NodeOpenedEvent",NODE_CLOSED:"NodeClosedEvent",ZOOM_CHANGED:"ZoomChangedEvent",NOTIFICATION_INFO:"NotificationInfoEvent",NOTIFICATION_WARN:"NotificationWarnEvent",NOTIFICATION_ERROR:"NotificationErrorEvent"};mindmaps.EventBus=EventEmitter;
if(mindmaps.DEBUG){var old=mindmaps.EventBus.prototype.emit;mindmaps.EventBus.prototype.publish=function(a){var b=this.listeners(a).length;console.log("EventBus > publish: "+a,"(Listeners: "+b+")");old.apply(this,arguments)}};mindmaps.SaveDocumentView=function(){var a=this,b=$("#template-save").tmpl().dialog({autoOpen:!1,modal:!0,zIndex:5E3,width:550,close:function(){$(this).dialog("destroy");$(this).remove()}});$("#button-save-cloudstorage").button().click(function(){a.cloudStorageButtonClicked&&a.cloudStorageButtonClicked()});$("#button-save-localstorage").button().click(function(){a.localStorageButtonClicked&&a.localStorageButtonClicked()});var c=$("#checkbox-autosave-localstorage").click(function(){a.autoSaveCheckboxClicked&&
a.autoSaveCheckboxClicked($(this).prop("checked"))});$("#button-save-hdd").button().downloadify({filename:function(){if(a.fileNameRequested)return a.fileNameRequested()},data:function(){if(a.fileContentsRequested)return a.fileContentsRequested()},onComplete:function(){a.saveToHddComplete&&a.saveToHddComplete()},onError:function(){console.log("error while saving to hdd")},swf:"media/downloadify.swf",downloadImage:"img/transparent.png",width:65,height:29,append:!0});this.setAutoSaveCheckboxState=function(a){c.prop("checked",
a)};this.showSaveDialog=function(){b.dialog("open")};this.hideSaveDialog=function(){b.dialog("close")};this.showCloudError=function(a){b.find(".cloud-error").text(a)}};
mindmaps.SaveDocumentPresenter=function(a,b,c,d,e){c.cloudStorageButtonClicked=function(){mindmaps.Util.trackEvent("Clicks","cloud-save");e.save({success:function(){c.hideSaveDialog()},error:function(a){c.showCloudError(a)}})};c.localStorageButtonClicked=function(){mindmaps.Util.trackEvent("Clicks","localstorage-save");b.saveToLocalStorage()?c.hideSaveDialog():a.publish(mindmaps.Event.NOTIFICATION_ERROR,"Error while saving to local storage")};c.autoSaveCheckboxClicked=function(a){a?d.enable():d.disable()};
c.fileNameRequested=function(){mindmaps.Util.trackEvent("Clicks","hdd-save");return b.getMindMap().getRoot().getCaption()+".json"};c.fileContentsRequested=function(){return b.getDocument().prepareSave().serialize()};c.saveToHddComplete=function(){var e=b.getDocument();a.publish(mindmaps.Event.DOCUMENT_SAVED,e);c.hideSaveDialog()};this.go=function(){c.setAutoSaveCheckboxState(d.isEnabled());c.showSaveDialog()}};mindmaps.ExportMapView=function(){var a=$("#template-export-map").tmpl().dialog({autoOpen:!1,modal:!0,zIndex:5E3,width:"auto",height:"auto",close:function(){$(this).dialog("destroy");$(this).remove()},open:function(){$(this).css({"max-width":0.9*$(window).width(),"max-height":0.8*$(window).height()});a.dialog("option","position","center")},buttons:{Ok:function(){$(this).dialog("close")}}});this.showDialog=function(){a.dialog("open")};this.hideDialog=function(){a.dialog("close")};this.setImage=function(a){$("#export-preview").html(a)}};
mindmaps.ExportMapPresenter=function(a,b,c){var d=new mindmaps.StaticCanvasRenderer;this.go=function(){var a=d.renderAsPNG(b.getDocument());c.setImage(a);setTimeout(function(){c.showDialog()},30)}};mindmaps.ShortcutController=function(){function a(a,c){return(c||"keydown")+"."+a}this.shortcuts={};this.register=function(b,c,d){Array.isArray(b)||(b=[b]);b.forEach(function(b){d=a(b,d);$(document).bind(d,b,function(a){a.stopImmediatePropagation();a.stopPropagation();a.preventDefault();c();return!1})})};this.unregister=function(b,c){c=a(b,c);$(document).unbind(c);delete this.shortcuts[c]};this.unregisterAll=function(){for(var a in shortcuts)$(document).unbind(a)}};mindmaps.StaticCanvasRenderer=function(){function a(a){var h;function i(a,d){e.save();e.translate(a.offset.x,a.offset.y);d&&(e.save(),f.render(e,a.getDepth(),a.offset.x,a.offset.y,a,d,a.branchColor,c),e.restore());if(!a.isRoot()){e.fillStyle=a.branchColor;var g=a.textMetrics;e.fillRect(0,g.height+b,g.width,a.lineWidth)}a.forEachChild(function(b){i(b,a)});e.restore()}function j(a){e.save();e.translate(a.offset.x,a.offset.y);var b=a.textMetrics,c=a.getCaption(),d=a.text.font;e.font=d.style+" "+d.weight+
" "+d.size+"px sans-serif";var f=b.width/2,g=0;a.isRoot()&&(f=0,g=20,e.lineWidth=5,e.strokeStyle="orange",e.fillStyle="white",mindmaps.CanvasDrawingUtil.roundedRect(e,0-b.width/2-4,16,b.width+8,b.height+8,10));e.strokeStyle=d.color;e.fillStyle=d.color;if(e.measureText(c).width<=b.width)e.fillText(c,f,g);else{c=c.match(/[^ ]+ */gi);console.log("words1",c);var h=[];c.forEach(function(a){if(e.measureText(a).width<=b.width)h.push(a);else{for(var c="",d=0;d<a.length;d++){var f=a.charAt(d);e.measureText(c+
f).width<=b.width?c+=f:(h.push(c),c=f)}h.push(c)}});console.log("words2",h);var i=[],m="",k=b.width;h.forEach(function(a){""===m?m=a:e.measureText(m+" "+a).width>k?(i.push(m),m=a):m+=" "+a});i.push(m);console.log("lines",i);for(c=0;c<i.length;c++)m=i[c],e.fillText(m,f,g+c*d.size)}a.forEachChild(function(a){j(a)});e.restore()}var k=function(a){var e=mindmaps.CanvasDrawingUtil.getLineWidth(c,a.getDepth()),d=mindmaps.TextMetrics.getTextMetrics(a,c);$.extend(a,{lineWidth:e,textMetrics:d,width:function(){return a.isRoot()?
0:d.width},innerHeight:function(){return d.height+b},outerHeight:function(){return d.height+e+b}});a.forEachChild(function(a){k(a)})},a=a.mindmap.getRoot().clone();k(a);var n=function(a){var b=a.getPosition(),c=a.textMetrics;b.x<l&&(l=b.x);b.x+c.width>p&&(p=b.x+c.width);b.y<m&&(m=b.y);b.y+a.outerHeight()>r&&(r=b.y+a.outerHeight())};a.getPosition();var l=0,m=0,p=0,r=0;n(a);a.forEachDescendant(function(a){n(a)});h=Math.max(Math.abs(p),Math.abs(l));var q=Math.max(Math.abs(r),Math.abs(m));h=2*h+50;q=
2*q+50;d.attr({width:h,height:q});e.textBaseline="top";e.textAlign="center";e.fillStyle="white";e.fillRect(0,0,h,q);e.translate(h/2,q/2);i(a);j(a)}var b=8,c=1,d=$("<canvas/>",{"class":"map"}),e=d[0].getContext("2d"),f=new mindmaps.CanvasBranchDrawer;f.beforeDraw=function(a,b,c,d){e.translate(c,d)};this.getImageData=function(b){a(b);return d[0].toDataURL("image/png")};this.renderAsPNG=function(a){a=this.getImageData(a);return $("<img/>",{src:a,"class":"map"})};this.renderAsCanvas=function(b){a(b);
return d}};mindmaps.FloatPanelFactory=function(a){var b=a.getContent(),c=[];this.create=function(d,e){var f=new mindmaps.FloatPanel(d,b,e);a.subscribe(mindmaps.CanvasContainer.Event.RESIZED,function(){c.forEach(function(a){a.visible&&a.ensurePosition()})});var g=b.outerWidth(),h=b.offset().top,i=f.width();f.height();var j=c.reduce(function(a,b){return a+b.height()+5},0);f.setPosition(g-i-15,h+5+j);c.push(f);return f}};
mindmaps.FloatPanel=function(a,b,c){var d=this,e=!1;this.caption=a;this.visible=!1;this.animationDuration=400;this.setContent=function(a){this.clearContent();$("div.ui-dialog-content",this.$widget).append(a)};this.clearContent=function(){$("div.ui-dialog-content",this.$widget).children().detach()};a=$("#template-float-panel").tmpl({title:a});a.find(".ui-dialog-titlebar-close").click(function(){d.hide()});c&&a.find(".ui-dialog-content").append(c);a.draggable({containment:"parent",handle:"div.ui-dialog-titlebar",
opacity:0.75}).hide().appendTo(b);this.$widget=a;this.hide=function(){!e&&this.visible&&(this.visible=!1,this.$widget.fadeOut(1.5*this.animationDuration),this.$hideTarget&&this.transfer(this.$widget,this.$hideTarget))};this.show=function(){!e&&!this.visible&&(this.visible=!0,this.$widget.fadeIn(1.5*this.animationDuration),this.ensurePosition(),this.$hideTarget&&this.transfer(this.$hideTarget,this.$widget))};this.toggle=function(){this.visible?this.hide():this.show()};this.transfer=function(a,b){e=
!0;var c=b.offset(),c={top:c.top,left:c.left,height:b.innerHeight(),width:b.innerWidth()},d=a.offset(),j=$('<div class="ui-effects-transfer"></div>').appendTo(document.body).css({top:d.top,left:d.left,height:a.innerHeight(),width:a.innerWidth(),position:"absolute"}).animate(c,this.animationDuration,"linear",function(){j.remove();e=!1})};this.width=function(){return this.$widget.outerWidth()};this.height=function(){return this.$widget.outerHeight()};this.offset=function(){return this.$widget.offset()};
this.setPosition=function(a,b){this.$widget.offset({left:a,top:b})};this.ensurePosition=function(){var a=b.outerWidth(),c=b.outerHeight(),e=b.offset().left,d=b.offset().top,j=this.width(),k=this.height(),n=this.offset().left,l=this.offset().top;a+e<j+n&&a>=j&&this.setPosition(a+e-j,l);c+d<k+l&&c>=k&&this.setPosition(n,c+d-k)};this.setHideTarget=function(a){this.$hideTarget=a}};mindmaps.StatusBarView=function(){var a=this,b=$("#statusbar");this.init=function(){};this.createButton=function(c,d){return $("<button/>",{id:"statusbar-button-"+c}).button({label:d}).click(function(){a.buttonClicked&&a.buttonClicked(c)}).prependTo(b.find(".buttons"))};this.getContent=function(){return b}};
mindmaps.StatusBarPresenter=function(a,b){var c=0,d={};new mindmaps.StatusNotificationController(a,b.getContent());b.buttonClicked=function(a){d[a].toggle()};this.go=function(){b.init()};this.addEntry=function(a){var f=c++,g=b.createButton(f,a.caption);a.setHideTarget(g);d[f]=a}};
mindmaps.StatusNotificationController=function(a,b){var c=$("<div class='notification-anchor'/>").css({position:"absolute",right:20}).appendTo(b);a.subscribe(mindmaps.Event.DOCUMENT_SAVED,function(){new mindmaps.Notification(c,{position:"topRight",expires:2500,content:"Mind map saved"})});a.subscribe(mindmaps.Event.NOTIFICATION_INFO,function(a){new mindmaps.Notification(c,{position:"topRight",content:a,expires:2500,type:"info"})});a.subscribe(mindmaps.Event.NOTIFICATION_WARN,function(a){new mindmaps.Notification(c,
{position:"topRight",title:"Warning",content:a,expires:3E3,type:"warn"})});a.subscribe(mindmaps.Event.NOTIFICATION_ERROR,function(a){new mindmaps.Notification(c,{position:"topRight",title:"Error",content:a,expires:3500,type:"error"})})};mindmaps.HelpController=function(a,b){var c=function(){m=new mindmaps.Notification("#toolbar",{position:"bottomMiddle",maxWidth:550,title:"Welcome to mindmaps",content:"Hello there, it seems like you are new here! These bubbles will guide you through the app. Or they won't if you want to skip this tutorial and <a class='skip-tutorial link'>click here<a/>."});l.push(m);m.$().find("a.skip-tutorial").click(function(){l.forEach(function(a){a.close()});n()});setTimeout(d,2E3)},d=function(){k()||(p=new mindmaps.Notification(".node-caption.root",
{position:"bottomMiddle",closeButton:!0,maxWidth:350,title:"This is where you start - your main idea",content:"Double click the idea to change what it says. This will be the main topic of your mind map."}),l.push(p),a.once(mindmaps.Event.NODE_TEXT_CAPTION_CHANGED,function(){p.close();setTimeout(e,900)}))},e=function(){if(!k()){var b=new mindmaps.Notification(".node-caption.root",{position:"bottomMiddle",closeButton:!0,maxWidth:350,padding:20,title:"Creating new ideas",content:"Now it's time to build your mind map.<br/> Move your mouse over the idea, click and then drag the <span style='color:red'>red circle</span> away from the root. This is how you create a new branch."});
l.push(b);a.once(mindmaps.Event.NODE_CREATED,function(){m.close();b.close();setTimeout(f,900)})}},f=function(){if(!k()){var b=new mindmaps.Notification(".node-container.root > .node-container:first",{position:"bottomMiddle",closeButton:!0,maxWidth:350,title:"Your first branch",content:"Great! This is easy, right? The red circle is your most important tool. Now, you can move your idea around by dragging it or double click to change the text again."});l.push(b);setTimeout(h,2E3);a.once(mindmaps.Event.NODE_MOVED,
function(){b.close();setTimeout(g,0);setTimeout(i,15E3);setTimeout(j,1E4);setTimeout(n,2E4)})}},g=function(){if(!k()){var a=new mindmaps.Notification(".float-panel:has(#navigator)",{position:"bottomRight",closeButton:!0,maxWidth:350,expires:1E4,title:"Navigation",content:"You can click and drag the background of the map to move around. Use your mousewheel or slider over there to zoom in and out."});l.push(a)}},h=function(){if(!k()){var a=new mindmaps.Notification("#inspector",{position:"leftBottom",
closeButton:!0,maxWidth:350,padding:20,title:"Don't like the colors?",content:"Use these controls to change the appearance of your ideas. Try clicking the icon in the upper right corner to minimize this panel."});l.push(a)}},i=function(){if(!k()){var a=new mindmaps.Notification("#toolbar .buttons-left",{position:"bottomLeft",closeButton:!0,maxWidth:350,padding:20,title:"The tool bar",content:"Those buttons do what they say. You can use them or work with keyboard shortcuts. Hover over the buttons for the key combinations."});
l.push(a)}},j=function(){if(!k()){var a=new mindmaps.Notification("#toolbar .buttons-right",{position:"leftTop",closeButton:!0,maxWidth:350,title:"Save your work",content:"The button to the right opens a menu where you can save your mind map or start working on another one if you like."});l.push(a)}},k=function(){return 1==mindmaps.LocalStorage.get("mindmaps.tutorial.done")},n=function(){mindmaps.LocalStorage.put("mindmaps.tutorial.done",1)};if(k())console.debug("skipping tutorial");else{var l=[];
a.once(mindmaps.Event.DOCUMENT_OPENED,function(){setTimeout(c,1E3)});var m,p}b.get(mindmaps.HelpCommand).setHandler(function(){if(r.some(function(a){return a.isVisible()}))r.forEach(function(a){a.close()}),r.length=0;else{var a=new mindmaps.Notification(".node-caption.root",{position:"bottomLeft",closeButton:!0,maxWidth:350,title:"This is your main idea",content:"Double click an idea to edit its text. Move the mouse over an idea and drag the red circle to create a new idea."}),b=new mindmaps.Notification("#navigator",
{position:"leftTop",closeButton:!0,maxWidth:350,padding:20,title:"This is the navigator",content:"Use this panel to get an overview of your map. You can navigate around by dragging the red rectangle or change the zoom by clicking on the magnifier buttons."}),c=new mindmaps.Notification("#inspector",{position:"leftTop",closeButton:!0,maxWidth:350,padding:20,title:"This is the inspector",content:"Use these controls to change the appearance of your ideas. Try clicking the icon in the upper right corner to minimize this panel."}),
e=new mindmaps.Notification("#toolbar .buttons-left",{position:"bottomLeft",closeButton:!0,maxWidth:350,title:"This is your toolbar",content:"Those buttons do what they say. You can use them or work with keyboard shortcuts. Hover over the buttons for the key combinations."});r.push(a,b,c,e)}});var r=[]};mindmaps.LocalStorage=function(){return{put:function(a,b){localStorage.setItem(a,b)},get:function(a){return localStorage.getItem(a)},clear:function(){localStorage.clear()}}}();mindmaps.SessionStorage=function(){return{put:function(a,b){sessionStorage.setItem(a,b)},get:function(a){return sessionStorage.getItem(a)},clear:function(){sessionStorage.clear()}}}();
mindmaps.LocalDocumentStorage=function(){var a=function(a){a=localStorage.getItem(a);if(null===a)return null;try{return mindmaps.Document.fromJSON(a)}catch(c){return console.error("Error while loading document from local storage",c),null}};return{saveDocument:function(a){try{return localStorage.setItem("mindmaps.document."+a.id,a.serialize()),!0}catch(c){return console.error("Error while saving document to local storage",c),!1}},loadDocument:function(b){return a("mindmaps.document."+b)},getDocuments:function(){for(var b=
[],c=0,d=localStorage.length;c<d;c++){var e=localStorage.key(c);0==e.indexOf("mindmaps.document.")&&(e=a(e))&&b.push(e)}return b},getDocumentIds:function(){for(var a=[],c=0,d=localStorage.length;c<d;c++){var e=localStorage.key(c);0==e.indexOf("mindmaps.document.")&&a.push(e.substring(18))}return a},deleteDocument:function(a){localStorage.removeItem("mindmaps.document."+a.id)},deleteAllDocuments:function(){this.getDocuments().forEach(this.deleteDocument)}}}();mindmaps.InspectorView=function(){var a=this,b=$("#template-inspector").tmpl(),c=$("#inspector-button-font-size-decrease",b),d=$("#inspector-button-font-size-increase",b),e=$("#inspector-checkbox-font-bold",b),f=$("#inspector-checkbox-font-italic",b),g=$("#inspector-checkbox-font-underline",b),h=$("#inspector-checkbox-font-linethrough",b),i=$("#inspector-button-branch-color-children",b),j=$("#inspector-branch-color-picker",b),k=$("#inspector-font-color-picker",b),n=[c,d,e,f,g,h,i],l=[j,k];this.getContent=
function(){return b};this.setControlsEnabled=function(a){var b=a?"enable":"disable";n.forEach(function(a){a.button(b)});l.forEach(function(b){b.miniColors("disabled",!a)})};this.setBoldCheckboxState=function(a){e.prop("checked",a).button("refresh")};this.setItalicCheckboxState=function(a){f.prop("checked",a).button("refresh")};this.setUnderlineCheckboxState=function(a){g.prop("checked",a).button("refresh")};this.setLinethroughCheckboxState=function(a){h.prop("checked",a).button("refresh")};this.setBranchColorPickerColor=
function(a){j.miniColors("value",a)};this.setFontColorPickerColor=function(a){k.miniColors("value",a)};this.init=function(){$(".buttonset",b).buttonset();i.button();c.click(function(){a.fontSizeDecreaseButtonClicked&&a.fontSizeDecreaseButtonClicked()});d.click(function(){a.fontSizeIncreaseButtonClicked&&a.fontSizeIncreaseButtonClicked()});e.click(function(){if(a.fontBoldCheckboxClicked){var b=$(this).prop("checked");a.fontBoldCheckboxClicked(b)}});f.click(function(){if(a.fontItalicCheckboxClicked){var b=
$(this).prop("checked");a.fontItalicCheckboxClicked(b)}});g.click(function(){if(a.fontUnderlineCheckboxClicked){var b=$(this).prop("checked");a.fontUnderlineCheckboxClicked(b)}});h.click(function(){if(a.fontLinethroughCheckboxClicked){var b=$(this).prop("checked");a.fontLinethroughCheckboxClicked(b)}});j.miniColors({hide:function(b){this.attr("disabled")||(console.log("hide branch",b),a.branchColorPicked&&a.branchColorPicked(b))},move:function(b){a.branchColorPreview&&a.branchColorPreview(b)}});k.miniColors({hide:function(b){this.attr("disabled")||
(console.log("font",b),a.fontColorPicked&&a.fontColorPicked(b))},move:function(b){a.fontColorPreview&&a.fontColorPreview(b)}});i.click(function(){a.branchColorChildrenButtonClicked&&a.branchColorChildrenButtonClicked()})}};
mindmaps.InspectorPresenter=function(a,b,c){function d(a){var b=a.text.font;c.setBoldCheckboxState("bold"===b.weight);c.setItalicCheckboxState("italic"===b.style);c.setUnderlineCheckboxState("underline"===b.decoration);c.setLinethroughCheckboxState("line-through"===b.decoration);c.setFontColorPickerColor(b.color);c.setBranchColorPickerColor(a.branchColor)}c.fontSizeDecreaseButtonClicked=function(){var a=new mindmaps.action.DecreaseNodeFontSizeAction(b.selectedNode);b.executeAction(a)};c.fontSizeIncreaseButtonClicked=
function(){var a=new mindmaps.action.IncreaseNodeFontSizeAction(b.selectedNode);b.executeAction(a)};c.fontBoldCheckboxClicked=function(a){a=new mindmaps.action.SetFontWeightAction(b.selectedNode,a);b.executeAction(a)};c.fontItalicCheckboxClicked=function(a){a=new mindmaps.action.SetFontStyleAction(b.selectedNode,a);b.executeAction(a)};c.fontUnderlineCheckboxClicked=function(a){a=new mindmaps.action.SetFontDecorationAction(b.selectedNode,a?"underline":"none");b.executeAction(a)};c.fontLinethroughCheckboxClicked=
function(a){a=new mindmaps.action.SetFontDecorationAction(b.selectedNode,a?"line-through":"none");b.executeAction(a)};c.branchColorPicked=function(a){a=new mindmaps.action.SetBranchColorAction(b.selectedNode,a);b.executeAction(a)};c.branchColorPreview=function(c){a.publish(mindmaps.Event.NODE_BRANCH_COLOR_PREVIEW,b.selectedNode,c)};c.fontColorPicked=function(a){a=new mindmaps.action.SetFontColorAction(b.selectedNode,a);b.executeAction(a)};c.fontColorPreview=function(c){a.publish(mindmaps.Event.NODE_FONT_COLOR_PREVIEW,
b.selectedNode,c)};c.branchColorChildrenButtonClicked=function(){var a=new mindmaps.action.SetChildrenBranchColorAction(b.selectedNode);b.executeAction(a)};a.subscribe(mindmaps.Event.NODE_FONT_CHANGED,function(a){b.selectedNode===a&&d(a)});a.subscribe(mindmaps.Event.NODE_BRANCH_COLOR_CHANGED,function(a){b.selectedNode===a&&d(a)});a.subscribe(mindmaps.Event.NODE_SELECTED,function(a){d(a)});a.subscribe(mindmaps.Event.DOCUMENT_OPENED,function(){c.setControlsEnabled(!0)});a.subscribe(mindmaps.Event.DOCUMENT_CLOSED,
function(){c.setControlsEnabled(!1)});this.go=function(){c.init()}};mindmaps.ToolBarView=function(){this.init=function(){};this.addButton=function(a,b){b(a.asJquery())};this.addButtonGroup=function(a,b){var c=$("<span/>");a.forEach(function(a){c.append(a.asJquery())});c.buttonset();b(c)};this.addMenu=function(a){this.alignRight(a.getContent())};this.alignLeft=function(a){a.appendTo("#toolbar .buttons-left")};this.alignRight=function(a){a.appendTo("#toolbar .buttons-right")}};
mindmaps.ToolBarButton=function(a){this.command=a;var b=this;a.subscribe(mindmaps.Command.Event.ENABLED_CHANGED,function(a){b.setEnabled&&b.setEnabled(a)})};mindmaps.ToolBarButton.prototype.isEnabled=function(){return this.command.enabled};mindmaps.ToolBarButton.prototype.click=function(){this.command.execute()};mindmaps.ToolBarButton.prototype.getTitle=function(){return this.command.label};
mindmaps.ToolBarButton.prototype.getToolTip=function(){var a=this.command.description,b=this.command.shortcut;b&&(Array.isArray(b)&&(b=b.join(", ")),a+=" ["+b.toUpperCase()+"]");return a};mindmaps.ToolBarButton.prototype.getId=function(){return"button-"+this.command.id};
mindmaps.ToolBarButton.prototype.asJquery=function(){var a=this,b=$("<button/>",{id:this.getId(),title:this.getToolTip()}).click(function(){a.click()}).button({label:this.getTitle(),disabled:!this.isEnabled()}),c=this.command.icon;c&&b.button({icons:{primary:c}});this.setEnabled=function(a){b.button(a?"enable":"disable")};return b};
mindmaps.ToolBarMenu=function(a,b){var c=this;this.$menuWrapper=$("<span/>",{"class":"menu-wrapper"}).hover(function(){c.$menu.show()},function(){c.$menu.hide()});this.$menuButton=$("<button/>").button({label:a,icons:{primary:b,secondary:"ui-icon-triangle-1-s"}}).appendTo(this.$menuWrapper);this.$menu=$("<div/>",{"class":"menu"}).click(function(){c.$menu.hide()}).appendTo(this.$menuWrapper);this.add=function(a){Array.isArray(a)||(a=[a]);a.forEach(function(a){a=a.asJquery().removeClass("ui-corner-all").addClass("menu-item");
this.$menu.append(a)},this);this.$menu.children().last().addClass("ui-corner-bottom").prev().removeClass("ui-corner-bottom")};this.getContent=function(){return this.$menuWrapper}};
mindmaps.ToolBarPresenter=function(a,b,c){function d(a){a=b.get(a);return new mindmaps.ToolBarButton(a)}a=[mindmaps.CreateNodeCommand,mindmaps.DeleteNodeCommand].map(d);c.addButtonGroup(a,c.alignLeft);a=[mindmaps.UndoCommand,mindmaps.RedoCommand].map(d);c.addButtonGroup(a,c.alignLeft);a=[mindmaps.CopyNodeCommand,mindmaps.CutNodeCommand,mindmaps.PasteNodeCommand].map(d);c.addButtonGroup(a,c.alignLeft);var a=new mindmaps.ToolBarMenu("Mind map","ui-icon-document"),e=[mindmaps.SaveDocumentCommand,mindmaps.ExportCommand,
mindmaps.PrintCommand,mindmaps.CloseDocumentCommand].map(d);a.add(e);c.addMenu(a);c.addButton(d(mindmaps.HelpCommand),c.alignRight);this.go=function(){c.init()}};mindmaps.CanvasContainer=function(){var a=this,b=$("#canvas-container");this.getContent=function(){return b};this.setSize=function(){var c=$(window).height(),d=$("#topbar").outerHeight(!0),e=$("#bottombar").outerHeight(!0),c=c-d-e;b.height(c);c=new mindmaps.Point(b.width(),c);a.publish(mindmaps.CanvasContainer.Event.RESIZED,c)};this.acceptFileDrop=function(){b.bind("dragover",function(a){a.originalEvent.stopPropagation();a.originalEvent.preventDefault()});b.bind("drop",function(b){b.originalEvent.stopPropagation();
b.originalEvent.preventDefault();var b=b.originalEvent.dataTransfer.files[0],d=new FileReader;d.onload=function(){a.receivedFileDrop(d.result)};d.readAsText(b)})};this.init=function(){$(window).resize(function(){a.setSize()});this.setSize();this.acceptFileDrop()};this.receivedFileDrop=function(){}};EventEmitter.mixin(mindmaps.CanvasContainer);mindmaps.CanvasContainer.Event={RESIZED:"ResizedEvent"};
mindmaps.MainViewController=function(a,b,c){var d=new mindmaps.ZoomController(a,c),e=new mindmaps.CanvasContainer;e.receivedFileDrop=function(c){try{var d=mindmaps.Document.fromJSON(c);b.setDocument(d)}catch(e){a.publish(mindmaps.Event.NOTIFICATION_ERROR,"Could not read the file."),console.warn("Could not open the mind map via drag and drop.")}};this.go=function(){e.init();var f=new mindmaps.ToolBarView;(new mindmaps.ToolBarPresenter(a,c,f,b)).go();f=new mindmaps.DefaultCanvasView;(new mindmaps.CanvasPresenter(a,
c,b,f,d)).go();var g=new mindmaps.StatusBarView,g=new mindmaps.StatusBarPresenter(a,g);g.go();var h=new mindmaps.FloatPanelFactory(e),i=new mindmaps.InspectorView;(new mindmaps.InspectorPresenter(a,b,i)).go();i=h.create("Inspector",i.getContent());i.show();g.addEntry(i);i=new mindmaps.NavigatorView;(new mindmaps.NavigatorPresenter(a,i,e,d)).go();h=h.create("Navigator",i.getContent());h.show();g.addEntry(h);return f}};mindmaps.UndoController=function(a,b){this.init=function(){this.undoManager=new UndoManager(128);this.undoManager.stateChanged=this.undoStateChanged.bind(this);this.undoCommand=b.get(mindmaps.UndoCommand);this.undoCommand.setHandler(this.doUndo.bind(this));this.redoCommand=b.get(mindmaps.RedoCommand);this.redoCommand.setHandler(this.doRedo.bind(this));a.subscribe(mindmaps.Event.DOCUMENT_OPENED,this.documentOpened.bind(this));a.subscribe(mindmaps.Event.DOCUMENT_CLOSED,this.documentClosed.bind(this))};
this.undoStateChanged=function(){this.undoCommand.setEnabled(this.undoManager.canUndo());this.redoCommand.setEnabled(this.undoManager.canRedo())};this.addUndo=function(a,b){this.undoManager.addUndo(a,b)};this.doUndo=function(){this.undoManager.undo()};this.doRedo=function(){this.undoManager.redo()};this.documentOpened=function(){this.undoManager.reset();this.undoStateChanged()};this.documentClosed=function(){this.undoManager.reset();this.undoStateChanged()};this.init()};mindmaps.MindMap=function(a){this.nodes=new mindmaps.NodeMap;a?this.root=a:(this.root=new mindmaps.Node,this.root.text.font.size=20,this.root.text.font.weight="bold",this.root.text.caption="Central Idea");this.addNode(this.root)};mindmaps.MindMap.fromJSON=function(a){return mindmaps.MindMap.fromObject(JSON.parse(a))};mindmaps.MindMap.fromObject=function(a){var a=mindmaps.Node.fromObject(a.root),b=new mindmaps.MindMap(a);a.forEachDescendant(function(a){b.addNode(a)});return b};
mindmaps.MindMap.prototype.toJSON=function(){return{root:this.root}};mindmaps.MindMap.prototype.serialize=function(){return JSON.stringify(this)};mindmaps.MindMap.prototype.createNode=function(){var a=new mindmaps.Node;this.addNode(a);return a};mindmaps.MindMap.prototype.addNode=function(a){this.nodes.add(a);var b=this;a.forEachDescendant(function(a){b.nodes.add(a)})};
mindmaps.MindMap.prototype.removeNode=function(a){a.parent.removeChild(a);var b=this;a.forEachDescendant(function(a){b.nodes.remove(a)});this.nodes.remove(a)};mindmaps.MindMap.prototype.getRoot=function(){return this.root};function UndoManager(a){this.maxStackSize=a||64;var b=this,c=new UndoManager.CircularStack(this.maxStackSize),d=new UndoManager.CircularStack(this.maxStackSize),e=!1,f=null,g=null,h=function(){b.stateChanged&&b.stateChanged()},i=function(a){f=a;e=!0;switch(g){case "undo":a.undo();break;case "redo":a.redo()}e=!1};this.addUndo=function(a,b){e?null==f.redo&&"undo"==g&&(f.redo=a):(c.push({undo:a,redo:b}),d.clear(),h())};this.undo=function(){if(this.canUndo()){g="undo";var a=c.pop();i(a);a.redo&&d.push(a);
h()}};this.redo=function(){if(this.canRedo()){g="redo";var a=d.pop();i(a);a.undo&&c.push(a);h()}};this.canUndo=function(){return!c.isEmpty()};this.canRedo=function(){return!d.isEmpty()};this.reset=function(){c.clear();d.clear();e=!1;g=f=null;h()};this.stateChanged=function(){}}UndoManager.CircularStack=function(a){this.maxSize=a||32;this.buffer=[];this.nextPointer=0};UndoManager.CircularStack.prototype.push=function(a){this.buffer[this.nextPointer]=a;this.nextPointer=(this.nextPointer+1)%this.maxSize};
UndoManager.CircularStack.prototype.isEmpty=function(){if(0===this.buffer.length)return!0;var a=this.getPreviousPointer();return null===a?!0:null===this.buffer[a]};UndoManager.CircularStack.prototype.getPreviousPointer=function(){return 0<this.nextPointer?this.nextPointer-1:this.buffer.length<this.maxSize?null:this.maxSize-1};UndoManager.CircularStack.prototype.clear=function(){this.nextPointer=this.buffer.length=0};
UndoManager.CircularStack.prototype.pop=function(){if(this.isEmpty())return null;var a=this.getPreviousPointer(),b=this.buffer[a];this.buffer[a]=null;this.nextPointer=a;return b};UndoManager.CircularStack.prototype.peek=function(){return this.isEmpty()?null:this.buffer[this.getPreviousPointer()]};mindmaps.MindMapModel=function(a,b,c){var d=this;this.selectedNode=this.document=null;this.getDocument=function(){return this.document};this.setDocument=function(b){(this.document=b)?a.publish(mindmaps.Event.DOCUMENT_OPENED,b):a.publish(mindmaps.Event.DOCUMENT_CLOSED)};this.getMindMap=function(){return this.document?this.document.mindmap:null};this.init=function(){var c=b.get(mindmaps.CreateNodeCommand);c.setHandler(this.createNode.bind(this));var d=b.get(mindmaps.CreateSiblingNodeCommand);d.setHandler(this.createSiblingNode.bind(this));
var g=b.get(mindmaps.DeleteNodeCommand);g.setHandler(this.deleteNode.bind(this));a.subscribe(mindmaps.Event.DOCUMENT_CLOSED,function(){c.setEnabled(!1);d.setEnabled(!1);g.setEnabled(!1)});a.subscribe(mindmaps.Event.DOCUMENT_OPENED,function(){c.setEnabled(!0);d.setEnabled(!0);g.setEnabled(!0)})};this.deleteNode=function(a){a||(a=this.selectedNode);var b=this.getMindMap(),a=new mindmaps.action.DeleteNodeAction(a,b);this.executeAction(a)};this.createNode=function(a,b){var c=this.getMindMap();!a||!b?
(b=this.selectedNode,c=new mindmaps.action.CreateAutoPositionedNodeAction(b,c)):c=new mindmaps.action.CreateNodeAction(a,b,c);this.executeAction(c)};this.createNodeNoRender=function(a,b){var c=this.getMindMap();a.shouldEditCaption=!1;c=new mindmaps.action.CreateNodeNoRenderAction(a,b,c);this.executeAction(c)};this.nodeRendering=function(a,b){var c=this.getMindMap(),c=new mindmaps.action.NodeRenderingAction(a,b,c);this.executeAction(c)};this.createSiblingNode=function(){var a=this.getMindMap(),b=this.selectedNode.getParent();
null!==b&&(a=new mindmaps.action.CreateAutoPositionedNodeAction(b,a),this.executeAction(a))};this.selectNode=function(b){if(b!==this.selectedNode){var c=this.selectedNode;this.selectedNode=b;a.publish(mindmaps.Event.NODE_SELECTED,b,c)}};this.changeNodeCaption=function(a,b){a||(a=this.selectedNode);var c=new mindmaps.action.ChangeNodeCaptionAction(a,b);this.executeAction(c)};this.executeAction=function(b){if(b instanceof mindmaps.action.CompositeAction){var f=this.executeAction.bind(this);b.forEachAction(f)}else{f=
b.execute();if(void 0!==f&&!f)return!1;b.event&&(Array.isArray(b.event)||(b.event=[b.event]),a.publish.apply(a,b.event));if(b.undo){if(b.redo)var g=function(){d.executeAction(b.redo())};c.addUndo(function(){d.executeAction(b.undo())},g)}}};this.saveToLocalStorage=function(){var b=this.document.prepareSave(),c=mindmaps.LocalDocumentStorage.saveDocument(b);c&&a.publish(mindmaps.Event.DOCUMENT_SAVED,b);return c};this.init()};mindmaps.Util=mindmaps.Util||{};mindmaps.Util.trackEvent=function(a,b,c){window._gaq&&(c?_gaq.push(["_trackEvent",a,b,c]):_gaq.push(["_trackEvent",a,b]))};mindmaps.Util.createUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};mindmaps.Util.getId=function(){return mindmaps.Util.createUUID()};
mindmaps.Util.randomColor=function(){var a=(~~(16777216*Math.random())).toString(16);return"#000000".substr(0,7-a.length)+a};mindmaps.Util.getUrlParams=function(){for(var a={},b,c=/\+/g,d=/([^&=]+)=?([^&]*)/g,e=window.location.search.substring(1);b=d.exec(e);)a[decodeURIComponent(b[1].replace(c," "))]=decodeURIComponent(b[2].replace(c," "));return a};function timeit(a,b){var c=(new Date).getTime();a();c=(new Date).getTime()-c;console.log(b||"",c,"ms")}
mindmaps.Util.distance=function(a,b){return Math.sqrt(a*a+b*b)};
function getBinaryMapWithDepth(a){function b(a,c){if(0!==c){var e=d.createNode();e.text.caption="Node "+e.id;a.addChild(e);b(e,c-1);e=d.createNode();e.text.caption="Node "+e.id;a.addChild(e);b(e,c-1)}}function c(a,b,d){a.offset=new mindmaps.Point(50*(b+1),d);a.isLeaf()||(a=a.children.values(),c(a[0],b+1,d-d/2),c(a[1],b+1,d+d/2))}var d=new mindmaps.MindMap,e=d.root;b(e,a||10);e.offset=new mindmaps.Point(400,400);a=e.children.values();c(a[0],0,-80);c(a[1],0,80);a[0].branchColor=mindmaps.Util.randomColor();
a[0].forEachDescendant(function(a){a.branchColor=mindmaps.Util.randomColor()});a[1].branchColor=mindmaps.Util.randomColor();a[1].forEachDescendant(function(a){a.branchColor=mindmaps.Util.randomColor()});return d}
function getDefaultTestMap(){var a=new mindmaps.MindMap,b=a.root,c=a.createNode(),d=a.createNode(),e=a.createNode();b.addChild(c);b.addChild(d);b.addChild(e);b=a.createNode();c=a.createNode();d.addChild(b);d.addChild(c);var d=a.createNode(),c=a.createNode(),f=a.createNode(),g=a.createNode();e.addChild(d);e.addChild(c);e.addChild(f);e.addChild(g);e=a.createNode();b.addChild(e);b=a.createNode();e.addChild(b);return a}
function getDefaultTestDocument(){var a=new mindmaps.Document;a.title="test document";a.mindmap=getDefaultTestMap();return a}function getSimpleMap(){var a=new mindmaps.MindMap,b=a.root,c=a.createNode(),d=a.createNode();b.addChild(c);b.addChild(d);return a};var HGAP=10,VGAP=30,LAY_LEFT=0,LAY_RIGHT=1,NODE_TYPE_LEFT=0,NODE_TYPE_RIGHT=1,NODE_TYPE_ROOT=2;
interface_node={layout:function(){this.layout_implement.apply(this,arguments)},createMapNode:function(a,b){var c=new mindmaps.Node;c.id=this.id;c.text.caption=this.text;this.mapNode=c;c.branchColor=a.node_type==NODE_TYPE_ROOT?mindmaps.Util.randomColor():a.mapNode.branchColor;b.createNodeNoRender(c,a.mapNode)},shape_process:function(){var a,b;mind_node=this;b=$("#node-"+mind_node.id);a=b.width();b=b.height();var c=0;mind_node.height=0;$.each(mind_node.child,function(a,b){mind_node.height+=b.height+
HGAP;c<b.width&&(c=b.width)});0>=mind_node.height&&(mind_node.height=b);mind_node.width=a+c+VGAP;mind_node.ele_height=b;mind_node.ele_width=a}};
function root_imp(){var a=this;a.left_child=[];a.right_child=[];a.child=[];this.node_type=NODE_TYPE_ROOT;a.layout_implement=function(b,c){var d,e=[],f=(a.left_height-a.ele_height)/2;$.each(a.left_child,function(d,h){var i={root:a,key:d,val:h,y2:f};h.layout(b,c,i);f-=h.height+HGAP;e.push(i)});f=(a.right_height-a.ele_height)/2;for($.each(a.right_child,function(d,h){var i={root:a,key:d,val:h,y2:f};h.layout(b,c,i);f-=h.height+HGAP;e.push(i)});0<e.length;)d=e.pop(),f=(d.val.height-d.val.ele_height)/2,
$.each(d.val.child,function(a,h){var i={root:d.val,key:a,val:h,y2:f};f-=h.height+HGAP;h.layout(b,c,i);e.push(i)})};this.shape_process=function(){var a=this,c,d;d=$("#"+this.id);c=d.width();d=d.height();a.height=0;a.width=0;a.left_height=0;a.right_height=0;$.each(a.left_child,function(c,d){a.left_height+=d.height;a.width+=d.width});$.each(a.right_child,function(c,d){a.right_height+=d.height;a.width+=d.width});a.width+=c+2*VGAP;a.height=a.left_height>a.right_height?a.left_height:a.right_height;a.height=
a.height>d?a.height:d;a.ele_height=d;a.ele_width=c}}function left_imp(){this.child=[];this.node_type=NODE_TYPE_LEFT;this.layout_implement=function(a,b,c){b=c.y2;c=c.root;this.x=0-this.ele_width-VGAP;this.y=0-b+(this.height-this.ele_height)/2;this.mapNode.offset=new mindmaps.Point(this.x,this.y);a.nodeRendering(this.mapNode,c.mapNode)}}
function right_imp(){this.child=[];this.node_type=NODE_TYPE_RIGHT;this.layout_implement=function(a,b,c){b=c.y2;c=c.root;this.x=0+c.ele_width+VGAP;this.y=0-b+(this.height-this.ele_height)/2;this.mapNode.offset=new mindmaps.Point(this.x,this.y);a.nodeRendering(this.mapNode,c.mapNode)}}
(function(){root_imp.prototype=new root_imp;jQuery.extend(root_imp.prototype,interface_node);left_imp.prototype=new left_imp;jQuery.extend(left_imp.prototype,interface_node);right_imp.prototype=new right_imp;jQuery.extend(right_imp.prototype,interface_node)})();
(function(){window.mindMapWrap={init:function(a,b){theMe=mindMapWrap;var c=theMe.root;$("#idMap");var d=[],e,f;for(d.push({root:null,key:0,node:c,go:!0});0<d.length;)e=d[d.length-1],f=e.node,0<f.child.length&&e.go?($.each(f.child,function(c,e){e.createMapNode(f,a,b);d.push({root:f,key:c,node:e,go:!0})}),e.go=!1):(f.shape_process(),d.pop());c.layout(a,b)}};mindMapWrap.OnlineDocumentPresenter=function(a,b,c){a.subscribe(mindmaps.Event.NODE_CREATED_NO_RENDER,function(a){c.createNodeNoRender(a)});a.subscribe(mindmaps.Event.NODE_RENDERING,
function(a){c.nodeRendering(a)});this.go=function(){var a=mindMapWrap.root,e=new mindmaps.Node;e.id=a.id;e.text.font.size=20;e.text.font.weight="bold";e.text.caption=a.text;a.mapNode=e;a=new mindmaps.Document(e);b.setDocument(a);mindMapWrap.init(b,c);mindMapWrap=null}}})();(function(){window.mindMapWrap.root=new root_imp;window.mindMapWrap.objMap={}})();mindmaps.ZoomController=function(a){var b=this;this.ZOOM_STEP=0.25;this.MAX_ZOOM=3;this.MIN_ZOOM=0.25;this.zoomFactor=this.DEFAULT_ZOOM=1;this.zoomTo=function(b){b<=this.MAX_ZOOM&&b>=this.MIN_ZOOM&&(this.zoomFactor=b,a.publish(mindmaps.Event.ZOOM_CHANGED,b))};this.zoomIn=function(){this.zoomFactor+=this.ZOOM_STEP;this.zoomFactor>this.MAX_ZOOM?this.zoomFactor-=this.ZOOM_STEP:a.publish(mindmaps.Event.ZOOM_CHANGED,this.zoomFactor);return this.zoomFactor};this.zoomOut=function(){this.zoomFactor-=this.ZOOM_STEP;
this.zoomFactor<this.MIN_ZOOM?this.zoomFactor+=this.ZOOM_STEP:a.publish(mindmaps.Event.ZOOM_CHANGED,this.zoomFactor);return this.zoomFactor};a.subscribe(mindmaps.Event.DOCUMENT_CLOSED,function(){b.zoomTo(b.DEFAULT_ZOOM)})};var mindmaps=mindmaps||{};mindmaps.VERSION="0.7.2";window.addEventListener("load",function(){window.applicationCache.addEventListener("updateready",function(){window.applicationCache.status==window.applicationCache.UPDATEREADY&&(window.applicationCache.swapCache(),window.onbeforeunload=null,confirm("A new version of the app is available. Load it?")&&window.location.reload())},!1)},!1);
$(function(){removeEventLayerXY();createECMA5Shims();createHTML5Shims();setupConsole();trackErrors();mindmaps.DEBUG||addUnloadHook();(new mindmaps.ApplicationController).go()});function removeEventLayerXY(){for(var a=$.event.props,b=a.length,c=[];b--;){var d=a[b];"layerX"!=d&&"layerY"!=d&&c.push(d)}$.event.props=c}
function addUnloadHook(){window.onbeforeunload=function(a){if(a=a||window.event)a.returnValue="Are you sure? Any unsaved progress will be lost.";return"Are you sure? Any unsaved progress will be lost."}}function trackErrors(){window.onerror=function(a,b,c){if(window._gaq)return _gaq.push(["_trackEvent","Error Log",a,b+"_"+c]),!1}}
function setupConsole(){var a=function(){},b=window.console||{};["log","info","debug","warn","error"].forEach(function(c){b[c]=b[c]||a});mindmaps.DEBUG||(b.debug=a,b.info=a,b.log=a,b.warn=a,b.error=function(a){window.alert("Error: "+a)});window.console=b}$(function(){$("#bottombar table").remove();$("input[name='hosted_button_id']").val("123")});
function createECMA5Shims(){if(!Function.prototype.bind){var a=Array.prototype.slice;Function.prototype.bind=function(b){function c(){if(this instanceof c){var b=Object.create(d.prototype);d.apply(b,e.concat(a.call(arguments)));return b}return d.call.apply(d,e.concat(a.call(arguments)))}var d=this;if("function"!==typeof d.apply||"function"!==typeof d.call)return new TypeError;var e=a.call(arguments);c.length="function"===typeof d?Math.max(d.length-e.length,0):0;return c}}Array.isArray||(Array.isArray=
function(a){return"[object Array]"===Object.prototype.toString.call(a)});Array.prototype.forEach||(Array.prototype.forEach=function(a,c){for(var d=+this.length,e=0;e<d;e++)e in this&&a.call(c,this[e],e,this)});Array.prototype.map||(Array.prototype.map=function(a,c){var d=+this.length;if("function"!==typeof a)throw new TypeError;for(var e=Array(d),f=0;f<d;f++)f in this&&(e[f]=a.call(c,this[f],f,this));return e});Array.prototype.filter||(Array.prototype.filter=function(a,c){for(var d=[],e=0;e<this.length;e++)a.call(c,
this[e])&&d.push(this[e]);return d});Array.prototype.every||(Array.prototype.every=function(a,c){for(var d=0;d<this.length;d++)if(!a.call(c,this[d]))return!1;return!0});Array.prototype.some||(Array.prototype.some=function(a,c){for(var d=0;d<this.length;d++)if(a.call(c,this[d]))return!0;return!1});Array.prototype.reduce||(Array.prototype.reduce=function(a){var c=+this.length;if("function"!==typeof a)throw new TypeError;if(0===c&&1===arguments.length)throw new TypeError;var d=0;if(2<=arguments.length)var e=
arguments[1];else{do{if(d in this){e=this[d++];break}if(++d>=c)throw new TypeError;}while(1)}for(;d<c;d++)d in this&&(e=a.call(null,e,this[d],d,this));return e});Array.prototype.reduceRight||(Array.prototype.reduceRight=function(a){var c=+this.length;if("function"!==typeof a)throw new TypeError;if(0===c&&1===arguments.length)throw new TypeError;var d,c=c-1;if(2<=arguments.length)d=arguments[1];else{do{if(c in this){d=this[c--];break}if(0>--c)throw new TypeError;}while(1)}for(;0<=c;c--)c in this&&
(d=a.call(null,d,this[c],c,this));return d});Array.prototype.indexOf||(Array.prototype.indexOf=function(a,c){var d=this.length;if(!d)return-1;var e=c||0;if(e>=d)return-1;for(0>e&&(e+=d);e<d;e++)if(e in this&&a===this[e])return e;return-1});Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(a,c){var d=this.length;if(!d)return-1;var e=c||d;0>e&&(e+=d);for(e=Math.min(e,d-1);0<=e;e--)if(e in this&&a===this[e])return e;return-1});Date.now||(Date.now=function(){return(new Date).getTime()})}
function createHTML5Shims(){"undefined"==typeof window.localStorage&&(window.localStorage={getItem:function(){return null},setItem:function(){},clear:function(){},removeItem:function(){},length:0,key:function(){return null}})};
